const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/NotFound-DWAv_IQP.js","assets/js/vue-vendor-BXjljxxF.js","assets/js/Home-CPBByGev.js","assets/js/utils-CAMFpqwB.js","assets/js/ui-vendor-Dw_Tg2Bf.js","assets/css/Home-iaIUBbr1.css","assets/js/Sponsors-DyxhUbge.js","assets/js/AboutContainerPage-NTBtnfg7.js","assets/css/AboutContainerPage-CU_8-v_E.css","assets/js/Gallery-Bw5O8p3f.js","assets/css/Gallery-C8z3o58h.css","assets/js/Resources-B-bEG735.js","assets/css/Resources-tn0RQdqM.css","assets/js/Contact-CWLoJJO_.js","assets/css/Contact-CScBvORm.css","assets/js/2025chart-BqbJAwx3.js","assets/js/chart-vendor-DDAPq8KH.js","assets/css/2025chart-DQZbkkBo.css","assets/js/2025chart-html-C2cbHcpU.js","assets/js/PrivacyPolicy-CRbvFjqW.js","assets/css/PrivacyPolicy-CTH7UANr.css","assets/js/TermsOfService-BKQtUPnT.js","assets/css/TermsOfService-D5Bjdo7P.css","assets/js/CasdoorLogin-c5posuRa.js","assets/css/CasdoorLogin-CANQ812F.css","assets/js/CasdoorCallback-Dp75313G.js","assets/js/Index-CERnwsP3.js","assets/js/CachedAvatar-BtzP3KLJ.js","assets/css/CachedAvatar-Db0ah_gV.css","assets/css/Index-DGdF0WBk.css","assets/js/HomeView-k0ajIIU0.js","assets/js/github-DZr-4LJV.js","assets/css/HomeView-B-u8dwWp.css","assets/js/ProfileView-Dc_IthO3.js","assets/css/ProfileView-BlSEBCYU.css","assets/js/APIView-CXXunyNB.js","assets/css/APIView-CJgA6Pz2.css","assets/js/CalendarView-GD0nqXvG.js","assets/css/CalendarView-DHSCJQZs.css","assets/js/PitScoutingView-B-pq6I-p.js","assets/js/sweetalert2.esm.all-CZCIYDgo.js","assets/css/PitScoutingView-B2Mk5rkZ.css","assets/js/PitScoutingAdminView-D1VXNLpl.js","assets/css/PitScoutingAdminView-ClkzAtvm.css","assets/js/ScoutingAssignmentView-BDtRPckq.js","assets/css/ScoutingAssignmentView-DAfdwH33.css","assets/js/VersionView-BgmDohx_.js","assets/css/VersionView-CLfcW1CQ.css"])))=>i.map(i=>d[i]);
import{g as pt,j as _t,k as re,l as S,m as vt,q as F,x as M,y as z,d as le,R as yt,F as Je,z as Xe,A as me,B as Z,C as Te,D as ie,e as wt,E as Qe,T as It,G as _e,r as j,c as Ye,H as Ae,o as kt,I as St,J as bt,K as Tt,L as At}from"./vue-vendor-BXjljxxF.js";import{g as Et,c as be,a as $t,b as R}from"./utils-CAMFpqwB.js";import{I as Ze,b as Ct,M as Rt,S as Ut,g as xt}from"./ui-vendor-Dw_Tg2Bf.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();function Pt(o,e){if(o==null)return;let t=o;for(let r=0;r<e.length;r++){if(t===void 0||t[e[r]]===void 0)return;if(t===null||t[e[r]]===null)return null;t=t[e[r]]}return t}function $e(o,e,t){if(t.length===0)return e;const r=t[0];return t.length>1&&(e=$e(typeof o!="object"||o===null||!Object.prototype.hasOwnProperty.call(o,r)?Number.isInteger(Number(t[1]))?[]:{}:o[r],e,Array.prototype.slice.call(t,1))),Number.isInteger(Number(r))&&Array.isArray(o)?o.slice()[r]:Object.assign({},o,{[r]:e})}function et(o,e){if(o==null||e.length===0)return o;if(e.length===1){if(o==null)return o;if(Number.isInteger(e[0])&&Array.isArray(o))return Array.prototype.slice.call(o,0).splice(e[0],1);const t={};for(const r in o)t[r]=o[r];return delete t[e[0]],t}if(o[e[0]]==null){if(Number.isInteger(e[0])&&Array.isArray(o))return Array.prototype.concat.call([],o);const t={};for(const r in o)t[r]=o[r];return t}return $e(o,et(o[e[0]],Array.prototype.slice.call(e,1)),[e[0]])}function tt(o,e){return e.map(t=>t.split(".")).map(t=>[t,Pt(o,t)]).filter(t=>t[1]!==void 0).reduce((t,r)=>$e(t,r[1],r[0]),{})}function rt(o,e){return e.map(t=>t.split(".")).reduce((t,r)=>et(t,r),o)}function Pe(o,{storage:e,serializer:t,key:r,debug:n,pick:a,omit:s,beforeHydrate:i,afterHydrate:u},l,f=!0){try{f&&i?.(l);const m=e.getItem(r);if(m){const v=t.deserialize(m),g=a?tt(v,a):v,w=s?rt(g,s):g;o.$patch(w)}f&&u?.(l)}catch(m){n&&console.error("[pinia-plugin-persistedstate]",m)}}function De(o,{storage:e,serializer:t,key:r,debug:n,pick:a,omit:s}){try{const i=a?tt(o,a):o,u=s?rt(i,s):i,l=t.serialize(u);e.setItem(r,l)}catch(i){n&&console.error("[pinia-plugin-persistedstate]",i)}}function Dt(o,e){return typeof o=="function"?o(e):typeof o=="string"?o:e}function Nt(o,e,t){const{pinia:r,store:n,options:{persist:a=t}}=o;if(!a)return;if(!(n.$id in r.state.value)){const i=r._s.get(n.$id.replace("__hot:",""));i&&Promise.resolve().then(()=>i.$persist());return}const s=(Array.isArray(a)?a:a===!0?[{}]:[a]).map(e);n.$hydrate=({runHooks:i=!0}={})=>{s.forEach(u=>{Pe(n,u,o,i)})},n.$persist=()=>{s.forEach(i=>{De(n.$state,i)})},s.forEach(i=>{Pe(n,i,o),n.$subscribe((u,l)=>De(l,i),{detached:!0})})}function Lt(o={}){return function(e){Nt(e,t=>{const r=Dt(t.key,e.store.$id);return{key:(o.key?o.key:n=>n)(r),debug:t.debug??o.debug??!1,serializer:t.serializer??o.serializer??{serialize:n=>JSON.stringify(n),deserialize:n=>JSON.parse(n)},storage:t.storage??o.storage??window.localStorage,beforeHydrate:t.beforeHydrate??o.beforeHydrate,afterHydrate:t.afterHydrate??o.afterHydrate,pick:t.pick,omit:t.omit}},o.auto??!1)}}var ot=Lt(),X={},ve={exports:{}};function Ot(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ye={exports:{}};const Ft={},Vt=Object.freeze(Object.defineProperty({__proto__:null,default:Ft},Symbol.toStringTag,{value:"Module"})),Bt=Et(Vt);var Mt=ye.exports,Ne;function Ce(){return Ne||(Ne=1,(function(o,e){(function(t,r){o.exports=r()})(Mt,function(){var t=t||(function(r,n){var a;if(typeof window<"u"&&window.crypto&&(a=window.crypto),typeof self<"u"&&self.crypto&&(a=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(a=globalThis.crypto),!a&&typeof window<"u"&&window.msCrypto&&(a=window.msCrypto),!a&&typeof be<"u"&&be.crypto&&(a=be.crypto),!a&&typeof Ot=="function")try{a=Bt}catch{}var s=function(){if(a){if(typeof a.getRandomValues=="function")try{return a.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof a.randomBytes=="function")try{return a.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||(function(){function d(){}return function(h){var _;return d.prototype=h,_=new d,d.prototype=null,_}})(),u={},l=u.lib={},f=l.Base=(function(){return{extend:function(d){var h=i(this);return d&&h.mixIn(d),(!h.hasOwnProperty("init")||this.init===h.init)&&(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var d=this.extend();return d.init.apply(d,arguments),d},init:function(){},mixIn:function(d){for(var h in d)d.hasOwnProperty(h)&&(this[h]=d[h]);d.hasOwnProperty("toString")&&(this.toString=d.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),m=l.WordArray=f.extend({init:function(d,h){d=this.words=d||[],h!=n?this.sigBytes=h:this.sigBytes=d.length*4},toString:function(d){return(d||g).stringify(this)},concat:function(d){var h=this.words,_=d.words,I=this.sigBytes,$=d.sigBytes;if(this.clamp(),I%4)for(var C=0;C<$;C++){var U=_[C>>>2]>>>24-C%4*8&255;h[I+C>>>2]|=U<<24-(I+C)%4*8}else for(var x=0;x<$;x+=4)h[I+x>>>2]=_[x>>>2];return this.sigBytes+=$,this},clamp:function(){var d=this.words,h=this.sigBytes;d[h>>>2]&=4294967295<<32-h%4*8,d.length=r.ceil(h/4)},clone:function(){var d=f.clone.call(this);return d.words=this.words.slice(0),d},random:function(d){for(var h=[],_=0;_<d;_+=4)h.push(s());return new m.init(h,d)}}),v=u.enc={},g=v.Hex={stringify:function(d){for(var h=d.words,_=d.sigBytes,I=[],$=0;$<_;$++){var C=h[$>>>2]>>>24-$%4*8&255;I.push((C>>>4).toString(16)),I.push((C&15).toString(16))}return I.join("")},parse:function(d){for(var h=d.length,_=[],I=0;I<h;I+=2)_[I>>>3]|=parseInt(d.substr(I,2),16)<<24-I%8*4;return new m.init(_,h/2)}},w=v.Latin1={stringify:function(d){for(var h=d.words,_=d.sigBytes,I=[],$=0;$<_;$++){var C=h[$>>>2]>>>24-$%4*8&255;I.push(String.fromCharCode(C))}return I.join("")},parse:function(d){for(var h=d.length,_=[],I=0;I<h;I++)_[I>>>2]|=(d.charCodeAt(I)&255)<<24-I%4*8;return new m.init(_,h)}},p=v.Utf8={stringify:function(d){try{return decodeURIComponent(escape(w.stringify(d)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(d){return w.parse(unescape(encodeURIComponent(d)))}},y=l.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new m.init,this._nDataBytes=0},_append:function(d){typeof d=="string"&&(d=p.parse(d)),this._data.concat(d),this._nDataBytes+=d.sigBytes},_process:function(d){var h,_=this._data,I=_.words,$=_.sigBytes,C=this.blockSize,U=C*4,x=$/U;d?x=r.ceil(x):x=r.max((x|0)-this._minBufferSize,0);var ne=x*C,J=r.min(ne*4,$);if(ne){for(var ue=0;ue<ne;ue+=C)this._doProcessBlock(I,ue);h=I.splice(0,ne),_.sigBytes-=J}return new m.init(h,J)},clone:function(){var d=f.clone.call(this);return d._data=this._data.clone(),d},_minBufferSize:0});l.Hasher=y.extend({cfg:f.extend(),init:function(d){this.cfg=this.cfg.extend(d),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(d){return this._append(d),this._process(),this},finalize:function(d){d&&this._append(d);var h=this._doFinalize();return h},blockSize:16,_createHelper:function(d){return function(h,_){return new d.init(_).finalize(h)}},_createHmacHelper:function(d){return function(h,_){return new k.HMAC.init(d,_).finalize(h)}}});var k=u.algo={};return u})(Math);return t})})(ye)),ye.exports}var zt=ve.exports,Le;function qt(){return Le||(Le=1,(function(o,e){(function(t,r){o.exports=r(Ce())})(zt,function(t){return(function(r){var n=t,a=n.lib,s=a.WordArray,i=a.Hasher,u=n.algo,l=[],f=[];(function(){function g(k){for(var d=r.sqrt(k),h=2;h<=d;h++)if(!(k%h))return!1;return!0}function w(k){return(k-(k|0))*4294967296|0}for(var p=2,y=0;y<64;)g(p)&&(y<8&&(l[y]=w(r.pow(p,1/2))),f[y]=w(r.pow(p,1/3)),y++),p++})();var m=[],v=u.SHA256=i.extend({_doReset:function(){this._hash=new s.init(l.slice(0))},_doProcessBlock:function(g,w){for(var p=this._hash.words,y=p[0],k=p[1],d=p[2],h=p[3],_=p[4],I=p[5],$=p[6],C=p[7],U=0;U<64;U++){if(U<16)m[U]=g[w+U]|0;else{var x=m[U-15],ne=(x<<25|x>>>7)^(x<<14|x>>>18)^x>>>3,J=m[U-2],ue=(J<<15|J>>>17)^(J<<13|J>>>19)^J>>>10;m[U]=ne+m[U-7]+ue+m[U-16]}var dt=_&I^~_&$,ft=y&k^y&d^k&d,ht=(y<<30|y>>>2)^(y<<19|y>>>13)^(y<<10|y>>>22),gt=(_<<26|_>>>6)^(_<<21|_>>>11)^(_<<7|_>>>25),xe=C+gt+dt+f[U]+m[U],mt=ht+ft;C=$,$=I,I=_,_=h+xe|0,h=d,d=k,k=y,y=xe+mt|0}p[0]=p[0]+y|0,p[1]=p[1]+k|0,p[2]=p[2]+d|0,p[3]=p[3]+h|0,p[4]=p[4]+_|0,p[5]=p[5]+I|0,p[6]=p[6]+$|0,p[7]=p[7]+C|0},_doFinalize:function(){var g=this._data,w=g.words,p=this._nDataBytes*8,y=g.sigBytes*8;return w[y>>>5]|=128<<24-y%32,w[(y+64>>>9<<4)+14]=r.floor(p/4294967296),w[(y+64>>>9<<4)+15]=p,g.sigBytes=w.length*4,this._process(),this._hash},clone:function(){var g=i.clone.call(this);return g._hash=this._hash.clone(),g}});n.SHA256=i._createHelper(v),n.HmacSHA256=i._createHmacHelper(v)})(Math),t.SHA256})})(ve)),ve.exports}var we={exports:{}},Ht=we.exports,Oe;function Gt(){return Oe||(Oe=1,(function(o,e){(function(t,r){o.exports=r(Ce())})(Ht,function(t){return(function(){var r=t,n=r.lib,a=n.WordArray,s=r.enc;s.Base64={stringify:function(u){var l=u.words,f=u.sigBytes,m=this._map;u.clamp();for(var v=[],g=0;g<f;g+=3)for(var w=l[g>>>2]>>>24-g%4*8&255,p=l[g+1>>>2]>>>24-(g+1)%4*8&255,y=l[g+2>>>2]>>>24-(g+2)%4*8&255,k=w<<16|p<<8|y,d=0;d<4&&g+d*.75<f;d++)v.push(m.charAt(k>>>6*(3-d)&63));var h=m.charAt(64);if(h)for(;v.length%4;)v.push(h);return v.join("")},parse:function(u){var l=u.length,f=this._map,m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var v=0;v<f.length;v++)m[f.charCodeAt(v)]=v}var g=f.charAt(64);if(g){var w=u.indexOf(g);w!==-1&&(l=w)}return i(u,l,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function i(u,l,f){for(var m=[],v=0,g=0;g<l;g++)if(g%4){var w=f[u.charCodeAt(g-1)]<<g%4*2,p=f[u.charCodeAt(g)]>>>6-g%4*2,y=w|p;m[v>>>2]|=y<<24-v%4*8,v++}return a.create(m,v)}})(),t.enc.Base64})})(we)),we.exports}var Ie={exports:{}},Wt=Ie.exports,Fe;function jt(){return Fe||(Fe=1,(function(o,e){(function(t,r){o.exports=r(Ce())})(Wt,function(t){return(function(){if(typeof ArrayBuffer=="function"){var r=t,n=r.lib,a=n.WordArray,s=a.init,i=a.init=function(u){if(u instanceof ArrayBuffer&&(u=new Uint8Array(u)),(u instanceof Int8Array||typeof Uint8ClampedArray<"u"&&u instanceof Uint8ClampedArray||u instanceof Int16Array||u instanceof Uint16Array||u instanceof Int32Array||u instanceof Uint32Array||u instanceof Float32Array||u instanceof Float64Array)&&(u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength)),u instanceof Uint8Array){for(var l=u.byteLength,f=[],m=0;m<l;m++)f[m>>>2]|=u[m]<<24-m%4*8;s.call(this,f,l)}else s.apply(this,arguments)};i.prototype=a}})(),t.lib.WordArray})})(Ie)),Ie.exports}var Ve;function Kt(){if(Ve)return X;Ve=1;var o=X&&X.__assign||function(){return o=Object.assign||function(s){for(var i,u=1,l=arguments.length;u<l;u++){i=arguments[u];for(var f in i)Object.prototype.hasOwnProperty.call(i,f)&&(s[f]=i[f])}return s},o.apply(this,arguments)},e=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(X,"__esModule",{value:!0});var t=e(qt()),r=e(Gt()),n=e(jt()),a=(function(){function s(i){this.state="",this.codeVerifier="",this.corsRequestOptions={},this.config=i}return s.prototype.enableCorsCredentials=function(i){return this.corsRequestOptions=i?{credentials:"include",mode:"cors"}:{},this.corsRequestOptions},s.prototype.authorizeUrl=function(i){i===void 0&&(i={});var u=this.pkceChallengeFromVerifier(),l=new URLSearchParams(Object.assign({response_type:"code",client_id:this.config.client_id,state:this.getState(i.state||null),scope:this.config.requested_scopes,redirect_uri:this.config.redirect_uri,code_challenge:u,code_challenge_method:"S256"},i)).toString();return"".concat(this.config.authorization_endpoint,"?").concat(l)},s.prototype.exchangeForAccessToken=function(i,u){var l=this;return u===void 0&&(u={}),this.parseAuthResponseUrl(i).then(function(f){return fetch(l.config.token_endpoint,o({method:"POST",body:new URLSearchParams(Object.assign({grant_type:"authorization_code",code:f.code,client_id:l.config.client_id,redirect_uri:l.config.redirect_uri,code_verifier:l.getCodeVerifier()},u)),headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}},l.corsRequestOptions)).then(function(m){return m.json()})})},s.prototype.refreshAccessToken=function(i){return fetch(this.config.token_endpoint,{method:"POST",body:new URLSearchParams({grant_type:"refresh_token",client_id:this.config.client_id,refresh_token:i}),headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(u){return u.json()})},s.prototype.revokeToken=function(i,u){u===void 0&&(u=""),this.checkEndpoint("revoke_endpoint");var l=new URLSearchParams({token:i,client_id:this.config.client_id});return u.length&&l.append("token_type_hint",u),fetch(this.config.revoke_endpoint,{method:"POST",body:l,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(f){return f.ok}).catch(function(){return!1})},s.prototype.checkEndpoint=function(i){if(!this.config.hasOwnProperty(i))throw new Error("".concat(i," not configured."));var u=new URL(this.config[i]),l=["localhost","127.0.0.1"].indexOf(u.hostname)!==-1;if(u.protocol!=="https:"&&!l)throw new Error("Protocol ".concat(u.protocol," not allowed with this action."))},s.prototype.getCodeVerifier=function(){return this.codeVerifier===""&&(this.codeVerifier=this.randomStringFromStorage("pkce_code_verifier")),this.codeVerifier},s.prototype.getState=function(i){i===void 0&&(i=null);var u="pkce_state";return i!==null&&this.getStore().setItem(u,i),this.state===""&&(this.state=this.randomStringFromStorage(u)),this.state},s.prototype.parseAuthResponseUrl=function(i){var u=new URL(i).searchParams;return this.validateAuthResponse({error:u.get("error"),query:u.get("query"),state:u.get("state"),code:u.get("code")})},s.prototype.pkceChallengeFromVerifier=function(){var i=(0,t.default)(this.getCodeVerifier());return r.default.stringify(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},s.prototype.randomStringFromStorage=function(i){var u=this.getStore().getItem(i);return u===null&&this.getStore().setItem(i,n.default.random(64)),this.getStore().getItem(i)||""},s.prototype.validateAuthResponse=function(i){var u=this;return new Promise(function(l,f){return i.error?f({error:i.error}):i.state!==u.getState()?f({error:"Invalid State"}):l(i)})},s.prototype.getStore=function(){var i;return((i=this.config)===null||i===void 0?void 0:i.storage)||sessionStorage},s})();return X.default=a,X}var Jt=Kt();const Xt=$t(Jt);class fe extends Error{}fe.prototype.name="InvalidTokenError";function Qt(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function Yt(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Qt(e)}catch{return atob(e)}}function Be(o,e){if(typeof o!="string")throw new fe("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,r=o.split(".")[t];if(typeof r!="string")throw new fe(`Invalid token specified: missing part #${t+1}`);let n;try{n=Yt(r)}catch(a){throw new fe(`Invalid token specified: invalid base64 for part #${t+1} (${a.message})`)}try{return JSON.parse(n)}catch(a){throw new fe(`Invalid token specified: invalid json for part #${t+1} (${a.message})`)}}class Zt{constructor(e){this.config=e,(e.redirectPath===void 0||e.redirectPath===null)&&(this.config.redirectPath="/callback"),(e.scope===void 0||e.scope===null)&&(this.config.scope="profile"),this.pkce=new Xt({client_id:this.config.clientId,redirect_uri:`${window.location.origin}${this.config.redirectPath}`,authorization_endpoint:`${this.config.serverUrl.trim()}/login/oauth/authorize`,token_endpoint:`${this.config.serverUrl.trim()}/api/login/oauth/access_token`,requested_scopes:this.config.scope||"profile",storage:this.config.storage})}getOrSaveState(){const e=sessionStorage.getItem("casdoor-state");if(e!==null)return e;{const t=Math.random().toString(36).slice(2);return sessionStorage.setItem("casdoor-state",t),t}}clearState(){sessionStorage.removeItem("casdoor-state")}getSignupUrl(e=!0){return e?(sessionStorage.setItem("signinUrl",this.getSigninUrl()),`${this.config.serverUrl.trim()}/signup/${this.config.appName}`):this.getSigninUrl().replace("/login/oauth/authorize","/signup/oauth/authorize")}getSigninUrl(){const e=this.config.redirectPath&&this.config.redirectPath.includes("://")?this.config.redirectPath:`${window.location.origin}${this.config.redirectPath}`,t=this.getOrSaveState();return`${this.config.serverUrl.trim()}/login/oauth/authorize?client_id=${this.config.clientId}&response_type=code&redirect_uri=${encodeURIComponent(e)}&scope=${this.config.scope}&state=${t}`}getUserProfileUrl(e,t){let r="";return t!=null&&(r=`?access_token=${t.accessToken}`),`${this.config.serverUrl.trim()}/users/${this.config.organizationName}/${e}${r}`}getMyProfileUrl(e,t=""){let r="";return e!=null?(r=`?access_token=${e.accessToken}`,t!==""&&(r+=`&returnUrl=${t}`)):t!==""&&(r=`?returnUrl=${t}`),`${this.config.serverUrl.trim()}/account${r}`}async signin(e,t,r,n){if(!r||!n){const s=new URLSearchParams(window.location.search);r=s.get("code"),n=s.get("state")}const a=this.getOrSaveState();return this.clearState(),n!==a?new Promise((s,i)=>{setTimeout(()=>{s({status:"error",msg:`invalid state parameter, expected: ${a}, got: ${n}`})},10)}):fetch(`${e}${t||this.config.signinPath||"/api/signin"}?code=${r}&state=${n}`,{method:"POST",credentials:"include"}).then(s=>s.json())}isSilentSigninRequested(){return new URLSearchParams(window.location.search).get("silentSignin")==="1"}silentSignin(e,t){const r=document.createElement("iframe");r.style.display="none",r.src=`${this.getSigninUrl()}&silentSignin=1`;const n=a=>{if(window!==window.parent)return null;const s=a.data;s.tag!=="Casdoor"||s.type!=="SilentSignin"||(s.data==="success"?e(s):t(s))};window.addEventListener("message",n),document.body.appendChild(r)}async popupSignin(e,t,r){const s=window.screen.width/2-250,i=window.screen.height/2-600/2,u=window.open(this.getSigninUrl()+"&popup=1","login",`width=500,height=600,top=${i},left=${s}`),l=f=>{f.origin===this.config.serverUrl&&(f.data.type==="windowClosed"&&r&&r("login failed"),f.data.type==="loginSuccess"&&(this.signin(e,t,f.data.data.code,f.data.data.state).then(m=>{sessionStorage.setItem("token",m.token),window.location.reload()}),u.close()))};window.addEventListener("message",l)}async signin_redirect(e){window.location.assign(this.pkce.authorizeUrl(e))}async exchangeForAccessToken(e){return this.pkce.exchangeForAccessToken(window.location.href,e)}async getUserInfo(e){return fetch(`${this.config.serverUrl.trim()}/api/userinfo`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}).then(t=>t.json())}parseAccessToken(e){try{const t=Be(e,{header:!0}),r=Be(e);return{header:t,payload:r}}catch(t){throw new Error(t.message)}}refreshAccessToken(e){return this.pkce.refreshAccessToken(e)}}const er="modulepreload",tr=function(o){return"/"+o},Me={},b=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){let u=function(l){return Promise.all(l.map(f=>Promise.resolve(f).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=s?.nonce||s?.getAttribute("nonce");n=u(t.map(l=>{if(l=tr(l),l in Me)return;Me[l]=!0;const f=l.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${m}`))return;const v=document.createElement("link");if(v.rel=f?"stylesheet":er,f||(v.as="script"),v.crossOrigin="",v.href=l,i&&v.setAttribute("nonce",i),document.head.appendChild(v),f)return new Promise((g,w)=>{v.addEventListener("load",g),v.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(s){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s}return n.then(s=>{for(const i of s||[])i.status==="rejected"&&a(i.reason);return e().catch(a)})},rr=window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")||window.location.hostname.includes("127.0.0."),K=rr?0:2,P={debug:"color: #6c757d; font-weight: bold;",info:"color: #0d6efd; font-weight: bold;",warn:"color: #ffc107; font-weight: bold;",error:"color: #dc3545; font-weight: bold;",important:"color: #6f42c1; font-weight: bold;"},Q=()=>{const o=new Date;return o.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+String(o.getMilliseconds()).padStart(3,"0")},ze=o=>{switch(o.toLowerCase()){case"success":return"#198754";case"error":return"#dc3545";case"warn":case"warning":return"#ffc107";case"info":return"#0d6efd";case"debug":return"#6c757d";case"important":return"#6f42c1";case"system":return"#20c997";case"primary":return"#0dcaf0";case"secondary":return"#6c757d";default:return o.startsWith("#")||o.startsWith("rgb")?o:"#0d6efd"}},G=()=>{const o=new Error().stack?.split(`
`)||[];let e="";for(let r=2;r<o.length;r++)if(!o[r].includes("logger.ts")){e=o[r];break}const t=e.match(/at\s+(.*)\s+\((.*):(\d+):(\d+)\)/)||e.match(/at\s+(.*):(\d+):(\d+)/);if(t){const r=t.length===4,n=r?t[1]:t[2],a=parseInt(r?t[2]:t[3],10),s=parseInt(r?t[3]:t[4],10),i=n.split("/");return{file:i[i.length-1],line:a,column:s}}return{file:"unknown",line:0,column:0}};let V=0;const q=[],c={debug:(o,...e)=>{if(K<=0){const t=Q(),r=G(),n=`${r.file}:${r.line}`;console.debug(`%c[DEBUG]%c ${t} %c${o}%c ${n}`,P.debug,"",P.debug,"color: #888; font-size: 0.85em;",...e)}},info:(o,...e)=>{if(K<=1){const t=Q(),r=G(),n=`${r.file}:${r.line}`;console.log(`%c[INFO]%c ${t} %c${o}%c ${n}`,P.info,"",P.info,"color: #888; font-size: 0.85em;",...e)}},warn:(o,...e)=>{if(K<=2){const t=Q(),r=G(),n=`${r.file}:${r.line}`;console.warn(`%c[WARN]%c ${t} %c${o}%c ${n}`,P.warn,"",P.warn,"color: #888; font-size: 0.85em;",...e)}},error:(o,...e)=>{if(K<=3){const t=Q(),r=G(),n=`${r.file}:${r.line}`;console.error(`%c[ERROR]%c ${t} %c${o}%c ${n}`,P.error,"",P.error,"color: #888; font-size: 0.85em;",...e)}},important:(o,...e)=>{const t=Q(),r=G(),n=`${r.file}:${r.line}`;console.log(`%c[IMPORTANT]%c ${t} %c${o}%c ${n}`,P.important,"",P.important,"color: #888; font-size: 0.85em;",...e)},group:(o,e=!0)=>{if(K<=0){V++;const t=G(),r=`${t.file}:${t.line}`,n=`[GROUP] ${o} ${r}`;q.push(o),e?console.groupCollapsed(n):console.group(n)}},groupEnd:()=>{K<=0&&V>0&&(console.groupEnd(),V--,q.length>0&&q.pop())},isGroupOpen:()=>V>0,getGroupDepth:()=>V,getGroupStack:()=>[...q],resetGroups:()=>{for(;V>0;)console.groupEnd(),V--;q.length=0,console.log("[LOGGER] All groups have been reset")},safeGroupEnd:o=>{if(K<=0)if(o){const e=q.lastIndexOf(o);if(e!==-1){const t=q.length-e;for(let r=0;r<t;r++)console.groupEnd(),V--,q.pop();console.log(`[LOGGER] Safely closed group "${o}" and ${t-1} nested groups`)}else V>0&&(console.groupEnd(),V--,console.log(`[LOGGER] Group "${o}" not found, closed the most recent group "${q.pop()||"unknown"}"`))}else V>0&&(console.groupEnd(),V--,console.log(`[LOGGER] Closed the most recent group "${q.pop()||"unknown"}"`))},pretty:(o,e,t="primary",r=!1)=>{if(t==="debug"&&K>0)return;const n=ze(t),a=r?Q():"",s=r?`[${a}] `:"",i=G(),u=`${i.file}:${i.line}`;console.log(`%c ${o} %c ${s}${e} %c ${u}`,`background:${n};border:1px solid ${n}; padding: 2px 5px; border-radius: 4px 0 0 4px; color: white; font-weight: bold;`,`border:1px solid ${n}; padding: 2px 5px; border-radius: 0 4px 4px 0; color: ${n}; font-weight: normal;`,"color: #888; font-size: 0.85em; padding-left: 4px;")},prettyGroup:(o,e="primary",t=!1)=>{const n=`
            color: white; 
            background: ${ze(e)}; 
            padding: 2px 6px; 
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
        `,a=G(),s=`${a.file}:${a.line}`,i=`${o} ${s}`;V++,q.push(o),t?console.groupCollapsed(`%c${i}`,n):console.group(`%c${i}`,n)},table:(o,e)=>{if(e){const t=Q(),r=G(),n=`${r.file}:${r.line}`;console.log(`%c[TABLE]%c ${t} %c${e}%c ${n}`,P.info,"",P.info,"color: #888; font-size: 0.85em;")}console.table(o)},http:(o,e,t=200,r=0)=>{let n="info";t>=500?n="error":t>=400?n="warn":t>=300?n="secondary":t>=200&&(n="success");let a=e;try{const u=new URL(e);a=u.pathname+u.search}catch{}const s=`${t}`,i=r>0?`${r}ms`:"";c.pretty(o.toUpperCase(),`${a} ${s} ${i}`,n,!0)},log:(o,e,...t)=>{if(o<K)return;const r={0:{method:console.debug,style:P.debug,label:"DEBUG"},1:{method:console.log,style:P.info,label:"INFO"},2:{method:console.warn,style:P.warn,label:"WARN"},3:{method:console.error,style:P.error,label:"ERROR"}},{method:n,style:a,label:s}=r[o],i=Q(),u=G(),l=`${u.file}:${u.line}`;n(`%c[${s}]%c ${i} %c${e}%c ${l}`,a,"",a,"color: #888; font-size: 0.85em;",...t)}},ee="avatar_cache_",qe=10080*60*1e3,He=200,or="avatar_cache_db",nr=2,N="avatars",te=1440*60*1e3,L="avatar_requests";class ar{memoryCache=new Map;requestCache=new Map;dbPromise=null;initialized=!1;initPromise=null;constructor(){this.initPromise=this.init()}isInitialized(){return this.initialized}async init(){if(this.initPromise)return this.initPromise;if(this.initialized)return Promise.resolve();c.info("Initializing avatar cache service...");try{this.dbPromise=this.openDatabase(),await this.dbPromise,await this.migrateFromLocalStorage(),await this.preloadRecentAvatars(),await this.loadRequestRecords(),this.initialized=!0,c.info(`Avatar cache initialized with ${this.memoryCache.size} entries in memory cache`)}catch(e){throw c.error("Failed to initialize avatar cache:",e),this.initPromise=null,e}}async cacheAvatar(e,t,r){if(this.initialized||await this.init(),!e||!t)return null;try{const n=e.length<=2;let a=e;if(n&&(c.warn(`Short userId detected: "${e}", might be using initials instead of real user ID`),r?.displayName&&(a=`pseudo_${this.hashCode(r.displayName)}`,c.debug(`Using pseudo ID for "${e}": ${a}`))),this.shouldThrottleRequest(t)){c.debug(`Request throttled for URL: ${t}`);const u=this.memoryCache.get(e);if(u)return c.debug(`Using memory cached avatar for throttled request: ${e}`),u.dataUrl;try{const l=await this.getFromDb(e);if(l)return this.memoryCache.set(e,l),c.debug(`Using DB avatar for throttled request: ${e}`),l.dataUrl}catch(l){c.warn(`Failed to get avatar from DB for throttled URL: ${t}`,l)}try{const l=await this.findEntriesByUrl(t);if(l.length>0){const f=l[0].dataUrl,m={dataUrl:f,timestamp:Date.now(),originalUrl:t,userId:e,userName:r?.name,displayName:r?.displayName,initial:r?.initial};return this.memoryCache.set(e,m),await this.saveToDb(e,m).catch(v=>c.warn(`Failed to save shared URL avatar to DB: ${v}`)),c.debug(`Using shared URL avatar for throttled request: ${e}`),f}}catch(l){c.warn(`Failed to find entries by URL for throttled request: ${t}`,l)}return null}c.debug(`Caching avatar for user ${a} (original: ${e}): ${t}`),this.recordRequest(t);const s=await this.fetchImageAsDataUrl(t);if(!s)return null;const i={dataUrl:s,timestamp:Date.now(),originalUrl:t,userId:a,userName:r?.name,displayName:r?.displayName,initial:r?.initial};return this.memoryCache.set(a,i),await this.saveToDb(a,i),s}catch(n){return c.error(`Failed to cache avatar for user ${e}:`,n),null}}async getAvatar(e,t,r,n=!1){this.initialized||await this.init();const a=e.length<=2;let s=e;if(a)try{const{AvatarMigrationTool:l}=await b(async()=>{const{AvatarMigrationTool:m}=await Promise.resolve().then(()=>gr);return{AvatarMigrationTool:m}},void 0),f=l.getUserIdByInitial(e);f?(c.debug(`Using mapped ID for "${e}": ${f}`),s=f):r?.displayName&&(s=`pseudo_${this.hashCode(r.displayName)}`,c.debug(`Using pseudo ID for "${e}": ${s}`))}catch{r?.displayName&&(s=`pseudo_${this.hashCode(r.displayName)}`,c.debug(`Using pseudo ID for "${e}" (fallback): ${s}`))}let i=this.memoryCache.get(s);if(!i&&s!==e&&(i=this.memoryCache.get(e)),i&&Date.now()-i.timestamp<qe)return t&&i.originalUrl!==t&&!n&&!this.shouldThrottleRequest(t)&&this.cacheAvatar(e,t,{name:r?.name,displayName:r?.displayName,initial:r?.initial}).catch(console.error),i.dataUrl;if(t&&!n)try{const l=await this.cacheAvatar(e,t,{name:r?.name,displayName:r?.displayName,initial:r?.initial});if(l)return l}catch(l){console.warn(`Failed to get avatar from URL: ${t}`,l)}try{const l=await this.getFromDb(e);if(l&&Date.now()-l.timestamp<qe)return this.memoryCache.set(e,l),l.dataUrl}catch(l){console.warn(`Failed to get avatar from DB for ${e}:`,l)}this.migrateOldCache(e);const u=this.getDefaultAvatar(e,r?.firstName,r?.lastName,r?.displayName,r?.name,r?.initial);if(n){const l={dataUrl:u,timestamp:Date.now(),originalUrl:"",userId:s,userName:r?.name,displayName:r?.displayName,initial:r?.initial};this.memoryCache.set(s,l),this.saveToDb(s,l).catch(f=>{c.warn(`Failed to save default avatar to DB: ${f}`)})}return u}async clearCache(e){this.initialized||await this.init(),e.length<=2&&c.warn(`Attempting to clear cache with short userId: "${e}", might need to check real user ID`),this.memoryCache.delete(e);try{const r=await this.dbPromise;if(!r)return;const a=r.transaction([N],"readwrite").objectStore(N);await B(a.delete(e))}catch(r){console.error(`Failed to delete avatar for ${e} from DB:`,r)}localStorage.removeItem(`${ee}${e}`),this.clearOldCache(e)}async clearAllCache(){this.initialized||await this.init(),this.memoryCache.clear();try{const e=await this.dbPromise;if(!e)return;const r=e.transaction([N],"readwrite").objectStore(N);await B(r.clear())}catch(e){console.error("Failed to clear avatar database:",e)}for(let e=localStorage.length-1;e>=0;e--){const t=localStorage.key(e);t&&t.startsWith(ee)&&localStorage.removeItem(t)}this.requestCache.clear();try{const e=await this.dbPromise;if(!e)return;if(e.objectStoreNames.contains(L)){const r=e.transaction([L],"readwrite").objectStore(L);await B(r.clear())}}catch(e){console.error("Failed to clear request records:",e)}}shouldThrottleRequest(e){const t=this.requestCache.get(e);if(!t)return!1;const r=Date.now()-t.timestamp;let n=te;return t.count>20?n=te:t.count>10?n=te*.5:t.count>5?n=te*.25:n=te*.125,r<n}recordRequest(e){const t=Date.now(),r=this.requestCache.get(e);r?t-r.timestamp>te?this.requestCache.set(e,{url:e,timestamp:t,count:1}):this.requestCache.set(e,{url:e,timestamp:t,count:r.count+1}):this.requestCache.set(e,{url:e,timestamp:t,count:1}),this.saveRequestRecord(e,this.requestCache.get(e)).catch(n=>{c.warn("Failed to save request record:",n)})}async saveRequestRecord(e,t){try{const r=await this.dbPromise;if(!r||!r.objectStoreNames.contains(L))return;const a=r.transaction([L],"readwrite").objectStore(L);await B(a.put(t,e))}catch(r){c.error(`Failed to save request record for ${e}:`,r)}}async loadRequestRecords(){try{const e=await this.dbPromise;if(!e||!e.objectStoreNames.contains(L))return;const r=e.transaction([L],"readonly").objectStore(L),n=await B(r.getAll()),a=await B(r.getAllKeys());for(let s=0;s<a.length;s++)s<n.length&&this.requestCache.set(String(a[s]),n[s]);c.info(`Loaded ${this.requestCache.size} request records`),this.cleanupRequestRecords()}catch(e){c.error("Failed to load request records:",e)}}async cleanupRequestRecords(){const e=Date.now(),t=[];this.requestCache.forEach((r,n)=>{e-r.timestamp>te*3&&t.push(n)});for(const r of t)this.requestCache.delete(r);try{if(t.length===0)return;const r=await this.dbPromise;if(!r||!r.objectStoreNames.contains(L))return;const a=r.transaction([L],"readwrite").objectStore(L);for(const s of t)B(a.delete(s)).catch(i=>{c.warn(`Failed to delete expired request record for ${s}:`,i)});c.info(`Cleaned up ${t.length} expired request records`)}catch(r){c.error("Failed to cleanup expired request records:",r)}}getDefaultAvatar(e,t,r,n,a,s){let i;if(s)i=s.substring(0,2).toUpperCase();else if(t&&r)i=(t.charAt(0)+r.charAt(0)).toUpperCase();else if(n){const g=n.trim().split(/\s+/);g.length>=2?i=(g[0].charAt(0)+g[g.length-1].charAt(0)).toUpperCase():i=n.substring(0,2).toUpperCase()}else if(a){const g=a.trim().split(/\s+/);g.length>=2?i=(g[0].charAt(0)+g[g.length-1].charAt(0)).toUpperCase():i=a.substring(0,2).toUpperCase()}else i=e.substring(0,2).toUpperCase();const l=this.hashCode(e)%360,v=`
        <svg xmlns="http://www.w3.org/2000/svg" width="${He}" height="${He}" viewBox="0 0 100 100">
            <rect width="100" height="100" fill="hsl(${l}, 75%, 65%)" />
            <text x="50" y="50" font-family="Arial" font-size="40" fill="white" text-anchor="middle" dominant-baseline="central">
                ${i}
            </text>
        </svg>
        `;return`data:image/svg+xml;base64,${btoa(v)}`}async fetchImageAsDataUrl(e){try{const t=await fetch(e,{cache:"force-cache",mode:"cors",credentials:"same-origin"});if(!t.ok)throw c.warn(`HTTP error fetching image. Status: ${t.status}`),new Error(`HTTP error! status: ${t.status}`);const r=await t.blob();return await this.blobToDataUrl(r)}catch(t){return c.warn(`Failed to fetch image from ${e}:`,t),null}}blobToDataUrl(e){return new Promise((t,r)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=r,n.readAsDataURL(e)})}hashCode(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return Math.abs(t)}clearOldCache(e){const t=[`avatar_${e}`,`user_avatar_${e}`];for(const r of t)localStorage.getItem(r)&&localStorage.removeItem(r)}migrateOldCache(e){const t=[`avatar_${e}`,`user_avatar_${e}`];for(const r of t){const n=localStorage.getItem(r);if(n)try{const a=JSON.parse(n);if(a&&a.dataUrl){const s={dataUrl:a.dataUrl,timestamp:a.timestamp||Date.now(),originalUrl:a.originalUrl||"",userId:e};this.memoryCache.set(e,s),localStorage.setItem(`${ee}${e}`,JSON.stringify(s)),localStorage.removeItem(r)}}catch(a){console.warn(`Failed to migrate old cache for ${r}:`,a)}}}clearOldestCaches(){try{const e=[];for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);if(n&&n.startsWith(ee)){const a=localStorage.getItem(n);if(a)try{const s=JSON.parse(a);e.push({key:n,timestamp:s.timestamp})}catch{e.push({key:n,timestamp:0})}}}e.sort((r,n)=>r.timestamp-n.timestamp);const t=Math.ceil(e.length/3);console.log(`Clearing ${t} oldest avatar caches`);for(let r=0;r<t&&r<e.length;r++){const n=e[r].key,a=n.substring(ee.length);this.memoryCache.delete(a),localStorage.removeItem(n)}}catch(e){console.error("Error clearing oldest caches:",e)}}openDatabase(){return new Promise((e,t)=>{if(!window.indexedDB){t(new Error("IndexedDB not supported in this browser"));return}const r=indexedDB.open(or,nr);r.onerror=n=>{t(new Error(`Failed to open IndexedDB: ${n.target.errorCode}`))},r.onsuccess=n=>{const a=n.target.result;e(a)},r.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(N)||a.createObjectStore(N),a.objectStoreNames.contains(L)||a.createObjectStore(L).createIndex("timestamp","timestamp",{unique:!1})}})}async saveToDb(e,t){try{const r=await this.dbPromise;if(!r)return;const a=r.transaction([N],"readwrite").objectStore(N);try{await B(a.put(t,e))}catch(s){c.warn("Storage error, attempting to clear space:",s),await this.ensureStorageSpace();const u=r.transaction([N],"readwrite").objectStore(N);await B(u.put(t,e))}}catch(r){throw c.error(`Failed to save avatar to IndexedDB for ${e}:`,r),r}}async getFromDb(e){try{const t=await this.dbPromise;if(!t)return;const n=t.transaction([N],"readonly").objectStore(N);return await B(n.get(e))}catch(t){throw c.error(`Failed to get avatar from IndexedDB for ${e}:`,t),t}}async getAllFromDb(){try{const e=await this.dbPromise;if(!e)return[];const r=e.transaction([N],"readonly").objectStore(N),n=await B(r.getAll()),a=await B(r.getAllKeys()),s=[];for(let i=0;i<a.length;i++)i<n.length&&s.push([String(a[i]),n[i]]);return s}catch(e){throw c.error("Failed to get all avatars from IndexedDB:",e),e}}async migrateFromLocalStorage(){try{const e=[];for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);if(r&&r.startsWith(ee)){const n=r.substring(ee.length),a=localStorage.getItem(r);if(a)try{const s=JSON.parse(a);await this.saveToDb(n,s),e.push(r)}catch(s){c.warn(`Failed to parse localStorage entry for ${r}:`,s)}}}for(const t of e)localStorage.removeItem(t);e.length>0&&c.info(`Migrated ${e.length} avatar entries from localStorage to IndexedDB`)}catch(e){c.error("Failed to migrate from localStorage:",e)}}async preloadRecentAvatars(e=20){try{const t=await this.getAllFromDb();t.sort((n,a)=>a[1].timestamp-n[1].timestamp);const r=t.slice(0,e);for(const[n,a]of r)this.memoryCache.set(n,a);c.info(`Preloaded ${r.length} recent avatars into memory cache`)}catch(t){c.error("Failed to preload recent avatars:",t)}}async ensureStorageSpace(){try{await this.clearOldestCaches(),console.log("Storage space cleared for new avatars")}catch(e){c.error("Failed to ensure storage space:",e)}}async getCacheStats(){try{this.initialized||await this.init();let e=0;try{e=(await this.getAllFromDb()).length}catch(t){c.error("Failed to get DB entries count:",t)}return{memoryEntries:this.memoryCache.size,requestEntries:this.requestCache.size,dbEntries:e}}catch(e){return c.error("Failed to get cache stats:",e),{memoryEntries:this.memoryCache.size,requestEntries:this.requestCache.size,dbEntries:0}}}async findEntriesByUrl(e){try{return(await this.getAllFromDb()).filter(([r,n])=>n.originalUrl===e).map(([r,n])=>n)}catch(t){return c.error("Failed to find entries by URL:",t),[]}}}function B(o){return new Promise((e,t)=>{o.onsuccess=()=>e(o.result),o.onerror=()=>t(o.error)})}const Ge=new ar,T={SIGNIN:"casdoor_signin_in_progress",REFRESH:"token_refresh_in_progress",VALIDATION:"auth_validation_in_progress",USER_REFRESH:"refreshing_user_info_lock",TEAM_API_VALIDATION:"team_api_validation_in_progress"};function Ee(o){const e=Date.now();Object.keys(o).forEach(t=>{const r=localStorage.getItem(t);if(r&&r!=="false"){const n=localStorage.getItem(`${t}_time`);if(n){const a=parseInt(n);e-a>o[t]&&(console.warn(`Cleaning up stale auth lock: ${t}`),O(t))}else O(t)}})}function sr(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"lock_"+Date.now().toString()+"_"+Math.random().toString(36).substring(2,15)}function he(o){if(localStorage.getItem(o)&&localStorage.getItem(o)!=="false")return{success:!1};const e=sr();try{return localStorage.setItem(o,e),localStorage.setItem(`${o}_time`,Date.now().toString()),localStorage.setItem(`${o}_owner`,e),{success:!0,lockId:e}}catch(t){console.error(`Failed to set auth lock ${o}:`,t);try{for(const r of Object.values(T))r!==o&&(localStorage.removeItem(r),localStorage.removeItem(`${r}_time`),localStorage.removeItem(`${r}_owner`));return localStorage.setItem(o,e),localStorage.setItem(`${o}_time`,Date.now().toString()),localStorage.setItem(`${o}_owner`,e),{success:!0,lockId:e}}catch(r){return console.error("Still failed to set auth lock after cleanup:",r),{success:!1}}}}function O(o,e){try{return localStorage.removeItem(o),localStorage.removeItem(`${o}_time`),localStorage.removeItem(`${o}_owner`),!0}catch(t){return console.error(`Error releasing auth lock ${o}:`,t),!1}}function ke(o,e=1e4,t){try{const r=localStorage.getItem(o);if(!r||r==="false")return!1;const n=localStorage.getItem(`${o}_time`);if(!n){try{localStorage.setItem(`${o}_time`,Date.now().toString())}catch(a){console.warn(`Failed to add timestamp for lock ${o}:`,a)}return!0}try{const a=parseInt(n);return isNaN(a)?(console.warn(`Invalid lock timestamp for ${o}`),localStorage.setItem(`${o}_time`,Date.now().toString()),!0):Date.now()-a<e}catch(a){console.warn(`Error checking lock timestamp for ${o}, clearing lock:`,a);try{O(o)}catch{}return!1}}catch(r){return console.error(`Error checking auth lock ${o}:`,r),!1}}function ir(){Ee({[T.SIGNIN]:2e4,[T.REFRESH]:1e4,[T.VALIDATION]:15e3,[T.USER_REFRESH]:1e4,[T.TEAM_API_VALIDATION]:1e4}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&Ee({[T.SIGNIN]:2e4,[T.REFRESH]:1e4,[T.VALIDATION]:15e3,[T.USER_REFRESH]:1e4,[T.TEAM_API_VALIDATION]:1e4})})}ir();const se={serverUrl:"https://sso.team695.com",clientId:"300932808273326bac0c",appName:"695_website",organizationName:"Team695",redirectPath:"/callback",storage:sessionStorage},ge=window.location.hostname==="localhost",We=window.location.hostname.includes("vercel.app"),ae={secure:window.location.protocol==="https:",sameSite:We?"none":ge?"lax":"strict",expires:2,path:"/",...We?{}:{}},cr=!0,A="casdoor-token",H="casdoor-refresh-token",lr="casdoor_session_id",W="casdoor-user-info-cache",Y="casdoor-user-info-timestamp",je=1440*60*1e3,ur=300*1e3,de=new Zt(se);class dr{userInfoCache=null;tokenExpiryTimer=null;tokenCheckTimer=null;refreshing=!1;refreshPromise=null;teamApiValidationPromise=null;config;getBasicUserInfoFromToken;constructor(){this.checkLocalStorageBackup(),this.setupTokenRefresh(),window.addEventListener("storage",this.handleStorageChange),this.setupTokenPeriodicCheck(),this.cleanupStaleLocks()}cleanupStaleLocks(){const e={[T.SIGNIN]:2e4,[T.REFRESH]:1e4,[T.VALIDATION]:15e3,[T.USER_REFRESH]:1e4,[T.TEAM_API_VALIDATION]:1e4};Ee(e)}handleStorageChange=e=>{if(e.key===A||e.key===H||e.key===W)if(e.key===W&&e.newValue)try{this.userInfoCache=JSON.parse(e.newValue)}catch{this.userInfoCache=null}else e.key===A&&this.setupTokenRefresh()};setupTokenRefresh(){this.tokenExpiryTimer!==null&&(window.clearTimeout(this.tokenExpiryTimer),this.tokenExpiryTimer=null);const e=this.getToken();if(e)try{const t=this.parseAccessToken(e);if(!t||!t.payload||!t.payload.exp)return;const r=t.payload.exp*1e3,n=Date.now(),a=r-n;if(a<=0){this.refreshAccessToken().catch(i=>{console.error("Failed to refresh expired token:",i)});return}const s=Math.max(a-300*1e3,0);console.log(`Token refresh scheduled in ${Math.floor(s/6e4)} minutes`),this.tokenExpiryTimer=window.setTimeout(()=>{this.refreshAccessToken().catch(i=>{console.error("Failed to refresh token:",i)})},s)}catch(t){console.error("Error setting up token refresh:",t)}}checkLocalStorageBackup(){try{const e=localStorage.getItem(A);if(e){console.log("Found backup token in localStorage, attempting to restore"),R.set(A,e,ae);const n=localStorage.getItem(H);n&&R.set(H,n,ae),R.get(A)?console.log("Successfully restored token from localStorage to cookie"):console.warn("Failed to restore token to cookie, will continue using localStorage")}const t=localStorage.getItem(W),r=localStorage.getItem(Y);if(t&&r){const n=parseInt(r,10);if(!isNaN(n)&&Date.now()-n<je)try{this.userInfoCache=JSON.parse(t)}catch(a){console.warn("Failed to parse cached user info:",a)}}}catch(e){console.error("Error checking localStorage backup:",e)}}startLogin(e){sessionStorage.removeItem("casdoor-state"),sessionStorage.removeItem("casdoor-code-verifier"),sessionStorage.removeItem("casdoor-code-challenge");const t={};e&&(t.provider=e),de.signin_redirect(t)}getSigninUrl(e){return de.getSigninUrl()+(e?`&provider=${e}`:"")}async signin(){try{const e=localStorage.getItem("token_absolute_trust")==="true",t=localStorage.getItem("trust_flags_expire_at"),r=localStorage.getItem("token_verified")==="true",n=localStorage.getItem("auth_callback_completed_time");let a=!1;if(t){const l=parseInt(t,10);if(!isNaN(l)&&Date.now()<l){if(n){const f=parseInt(n,10);!isNaN(f)&&l-f<900*1e3&&Date.now()-f<600*1e3&&(a=!0)}}else localStorage.removeItem("token_absolute_trust"),localStorage.removeItem("trust_flags_expire_at")}if(e&&a&&r){const l=this.getToken();if(l){const f=this.parseAccessToken(l);if(f?.payload?.exp&&f.payload.exp*1e3>Date.now())return c.info("Secure trust validation passed, using existing token"),l;c.warn("Token appears invalid despite trust flag, removing trust"),localStorage.removeItem("token_absolute_trust")}else localStorage.removeItem("token_absolute_trust")}const s=new URLSearchParams(window.location.search),i=s.get("code"),u=s.get("state");if(this.isLoggedIn()){console.log("Already have token, skipping code exchange completely");const l=this.getToken();if(l)return localStorage.setItem("token_absolute_trust","true"),localStorage.setItem("token_trusted","true"),localStorage.setItem("token_verified","true"),localStorage.setItem("auth_callback_completed_time",Date.now().toString()),l}if(!i||!u)throw console.warn("Missing code or state in signin request"),new Error("Invalid authorization callback - missing code or state");return this.signinWithCode(i,u)}catch(e){throw console.error("Signin error:",e),e}}async signinWithCode(e,t){try{const r=T.SIGNIN;if(sessionStorage.getItem("casdoor_auth_processed")==="true"){console.log("This authorization code was already processed");const l=this.getToken();if(l)return localStorage.setItem("token_absolute_trust","true"),localStorage.setItem("token_trusted","true"),localStorage.setItem("token_verified","true"),l;sessionStorage.removeItem("casdoor_auth_processed")}const a=this.getToken();if(a)return console.log("Found existing token, checking if it can be used instead of requesting new one"),localStorage.setItem("token_absolute_trust","true"),localStorage.setItem("token_trusted","true"),localStorage.setItem("token_verified","true"),localStorage.setItem("auth_callback_completed_time",Date.now().toString()),this.setupTokenRefresh(),sessionStorage.setItem("casdoor_auth_processed","true"),sessionStorage.setItem("casdoor_processed_code",e),a;const s=sessionStorage.getItem("force_token_refresh")==="true";if(sessionStorage.getItem("casdoor_processed_code")===e&&!s){console.log(`Authorization code ${e.substring(0,5)}... already processed, checking for existing token`);const l=this.getToken();if(l)return console.log("Found existing token for processed code, using it"),sessionStorage.setItem("casdoor_auth_processed","true"),l;console.log("No token found for processed code, clearing processed flag to retry"),sessionStorage.removeItem("casdoor_processed_code")}if(ke(r,2e4)){console.log("Signin already in progress, waiting for completion");for(let l=0;l<5;l++){await new Promise(m=>setTimeout(m,1e3));const f=this.getToken();if(f)return console.log("New token was generated while waiting"),sessionStorage.setItem("casdoor_auth_processed","true"),sessionStorage.setItem("casdoor_processed_code",e),f}console.warn("No token generated after waiting, clearing lock and continuing"),O(r)}if(!he(r).success){console.warn("Failed to acquire signin lock, another process may be signing in"),await new Promise(m=>setTimeout(m,2e3));const l=this.getToken();if(l)return console.log("Found token after waiting for lock"),sessionStorage.setItem("casdoor_auth_processed","true"),sessionStorage.setItem("casdoor_processed_code",e),l;O(r),he(r).success||console.error("Could not acquire signin lock after retrying, but continuing anyway")}try{sessionStorage.setItem("casdoor_processed_code",e),console.log("Exchanging code for token..."),sessionStorage.setItem("casdoor-state",t);const l=await de.exchangeForAccessToken();if(console.log("Token response received:",!!l),!l||!l.access_token)throw new Error("Failed to exchange code for token");return this.storeTokensInCookies(l),sessionStorage.setItem("casdoor_auth_processed","true"),l.access_token}finally{O(r)}}catch(r){throw console.error("Signin with code error:",r),sessionStorage.removeItem("casdoor_processed_code"),O(T.SIGNIN),r}}storeTokensInCookies(e){console.log("Storing tokens..."),e.access_token&&localStorage.setItem(A,e.access_token),e.refresh_token&&localStorage.setItem(H,e.refresh_token);try{e.access_token&&R.set(A,e.access_token,ae),e.refresh_token&&R.set(H,e.refresh_token,ae);const t=R.get(A);console.log("Cookie token set success:",!!t)}catch(t){console.warn("Error setting cookies, but tokens are stored in localStorage:",t)}this.userInfoCache=null,localStorage.removeItem(W),localStorage.removeItem(Y),this.setupTokenRefresh()}setTokens(e,t){localStorage.setItem(A,e),t&&localStorage.setItem(H,t);try{R.set(A,e,ae),t&&R.set(H,t,ae)}catch(r){console.warn("Error setting cookies, but tokens are stored in localStorage:",r)}this.userInfoCache=null,localStorage.removeItem(W),localStorage.removeItem(Y),this.setupTokenRefresh()}async refreshAccessToken(){const e=T.REFRESH;if(this.refreshing&&this.refreshPromise)return this.refreshPromise;if(ke(e,5e3)){console.log("Another refresh is in progress, waiting for it to complete"),await new Promise(a=>setTimeout(a,1e3));const n=this.getToken();if(n){const a=this.parseAccessToken(n);if(a?.payload?.exp&&a.payload.exp*1e3>Date.now()+600*1e3)return console.log("Using newly refreshed token from another process"),n}O(e)}else localStorage.getItem(e)==="true"&&O(e);he(e).success||console.error("Failed to acquire refresh lock");let r=localStorage.getItem(H);if(r||(r=R.get(H)||null),!r)throw new Error("No refresh token available");try{return this.refreshing=!0,this.refreshPromise=(async()=>{try{const n=await de.refreshAccessToken(r);if(!n||!n.access_token)throw new Error("Failed to refresh token");return this.storeTokensInCookies(n),n.access_token}finally{O(e)}})(),await this.refreshPromise}catch(n){throw console.error("Token refresh error:",n),this.logout(),O(e),n}finally{this.refreshing=!1,this.refreshPromise=null}}isLoggedIn(){return localStorage.getItem("token_absolute_trust")==="true"?localStorage.getItem(A)||R.get(A)?!0:(localStorage.removeItem("token_absolute_trust"),!1):localStorage.getItem("token_trusted")==="true"?localStorage.getItem(A)||R.get(A)?!0:(localStorage.removeItem("token_trusted"),!1):localStorage.getItem("token_verified")==="true"?localStorage.getItem(A)||R.get(A)?!0:(localStorage.removeItem("token_verified"),!1):localStorage.getItem(A)||R.get(A)?(localStorage.setItem("token_verified","true"),!0):!1}isUserAdmin(){if(localStorage.getItem("is_admin_validated")==="true"||this.userInfoCache?.isAdmin)return!0;const e=this.getToken();if(e)try{const t=this.parseAccessToken(e);if(t?.payload){const r=t.payload;if(r.role==="admin"||r.isAdmin===!0||r.groups&&Array.isArray(r.groups)&&r.groups.includes("admin"))return!0}}catch(t){console.warn("Error checking admin status from token:",t)}return!1}getToken(){const e=localStorage.getItem(A);return e||R.get(A)||null}parseAccessToken(e){try{return de.parseAccessToken(e)}catch(t){console.error("Error parsing JWT with SDK:",t);try{const r=e.split(".");if(r.length!==3)throw new Error("Invalid JWT format");const n=a=>{try{const s=a.replace(/-/g,"+").replace(/_/g,"/"),i=s+"=".repeat((4-s.length%4)%4);return JSON.parse(atob(i))}catch(s){return console.warn("JWT part decoding failed:",s),{}}};return{header:n(r[0]),payload:n(r[1])}}catch(r){return console.error("Manual JWT parsing failed:",r),null}}}async getUserInfo(e=!1){const t=this.getToken();if(!t)throw new Error("Not authenticated");if(!e){if(this.userInfoCache)return this.userInfoCache;const a=localStorage.getItem(W),s=localStorage.getItem(Y);if(a&&s){const i=parseInt(s,10);if(!isNaN(i)&&Date.now()-i<je)try{const u=JSON.parse(a);return this.userInfoCache=u,u}catch(u){console.warn("Failed to parse cached user info:",u)}}}const r=this.parseAccessToken(t);let n=null;if(r?.payload){const a=r.payload,s=a.role==="admin"||a.isAdmin===!0||a.groups&&Array.isArray(a.groups)&&a.groups.includes("admin"),i=pe(a);n={id:a.sub||"",name:a.name||"",email:a.email||"",owner:a.owner||"",displayName:a.displayName||"",firstName:a.firstName||"",lastName:a.lastName||"",fullName:i,avatar:a.avatar||null,isAdmin:s}}try{const a=await this.fetchUserInfoFromAPI(t);return a.id&&a.avatar&&(Ge.cacheAvatar(a.id,a.avatar).catch(s=>{console.warn("Failed to cache avatar:",s)}),Ge.getAvatar(a.id,a.avatar,{firstName:a.firstName,lastName:a.lastName,displayName:a.displayName,name:a.name}).catch(s=>{console.warn("Failed to preload avatar:",s)})),this.userInfoCache=a,localStorage.setItem(W,JSON.stringify(a)),localStorage.setItem(Y,Date.now().toString()),a}catch(a){console.error("Primary user info endpoint failed:",a);try{const i=`${ge?"/api/sso":se.serverUrl}/api/userinfo`,u=await fetch(i,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"},mode:"cors"});if(!u.ok)throw new Error(`Failed to get user info from secondary endpoint: ${u.status}`);const l=await u.json();return l.fullName||(l.fullName=pe(l)),this.userInfoCache=l,localStorage.setItem(W,JSON.stringify(l)),localStorage.setItem(Y,Date.now().toString()),l}catch(s){console.error("Secondary user info endpoint failed:",s);try{const u=`${ge?"/api/sso":se.serverUrl}/api/get-user`,l=await fetch(u,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"},mode:"cors"});if(!l.ok)throw new Error(`Failed to get user info from tertiary endpoint: ${l.status}`);const f=await l.json();return f.fullName||(f.fullName=pe(f)),this.userInfoCache=f,localStorage.setItem(W,JSON.stringify(f)),localStorage.setItem(Y,Date.now().toString()),f}catch(i){if(console.error("All user info endpoints failed:",i),n)return n;throw a}}}}async fetchUserInfoFromAPI(e){const r=`${ge?"/api/sso":se.serverUrl}/api/get-account`,n={headers:{Authorization:`Bearer ${e}`,Accept:"application/json"},mode:"cors"},a=await fetch(r,n);if(!a.ok)throw new Error(`Failed to get user info: ${a.status} ${a.statusText}`);const s=await a.json();let i;return s.data?(i=s.data,s.data2&&(i.data2=s.data2)):s.data&&s.data.payload?i=s.data.payload:i=s,i.fullName||(i.fullName=pe(i)),i}async logout(){try{const e=this.getToken();if(e)try{const r=`${ge?"/api/sso":se.serverUrl}/api/logout`;await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({token:e})}),console.log("Server logout successful")}catch(t){console.warn("Error during server logout API call:",t)}}catch(e){console.error("Error during server logout:",e)}finally{localStorage.removeItem("token_verified"),localStorage.removeItem("auth_callback_completed_time"),localStorage.removeItem("last_token_validated_time"),localStorage.removeItem("last_auth_check_time"),localStorage.removeItem("is_admin_validated"),this.tokenCheckTimer!==null&&(window.clearInterval(this.tokenCheckTimer),this.tokenCheckTimer=null),this.tokenExpiryTimer!==null&&(window.clearTimeout(this.tokenExpiryTimer),this.tokenExpiryTimer=null),this.userInfoCache=null,localStorage.removeItem(A),localStorage.removeItem(H),localStorage.removeItem(W),localStorage.removeItem(Y);try{R.remove(A,{path:"/"}),R.remove(H,{path:"/"}),R.remove(lr,{path:"/"})}catch(e){console.warn("Error removing cookies:",e)}return sessionStorage.clear(),Promise.resolve()}}handleTokenResponse(e){if(!e||!e.access_token)throw new Error("Invalid token response");this.storeTokensInCookies(e)}async validateWithTeamApi(e=null){if(localStorage.getItem("token_absolute_trust")==="true"&&localStorage.getItem("auth_callback_completed_time")!==null){const n=parseInt(localStorage.getItem("auth_callback_completed_time")||"0");if(Date.now()-n<600*1e3)return c.debug("Team API validation: Absolute trust flag detected during auth callback flow"),{valid:!0,isAdmin:localStorage.getItem("is_admin_validated")==="true"};localStorage.removeItem("token_absolute_trust")}const t=localStorage.getItem("is_periodic_validation")==="true",r=!t&&hr(10)&&localStorage.getItem("token_trusted")==="true";if(!t&&r){c.debug("Team API validation: Recent login with trust flag, but will still validate with API");const n=localStorage.getItem("team_api_validation_result");if(n)try{const a=JSON.parse(n);if(Date.now()-a.timestamp<6e4)if(e&&a.tokenHash&&a.tokenHash!==this.simpleTokenHash(e))c.debug("Token changed, not using cached validation result");else return c.debug("Using cached team API validation result"),{valid:a.valid,isAdmin:a.isAdmin}}catch{}}if(this.teamApiValidationPromise&&ke(T.TEAM_API_VALIDATION))return this.teamApiValidationPromise;if(e||(e=this.getToken()),!e)return{valid:!1,isAdmin:!1};try{return he(T.TEAM_API_VALIDATION),this.teamApiValidationPromise=(async()=>{try{c.info("Validating token with Casdoor API...");const n=`${se.serverUrl}/api/user`,a=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${e}`,Accept:"application/json","Content-Type":"application/json"}});if(!a.ok)return c.warn(`Casdoor API validation failed with status: ${a.status}`),{valid:!1,isAdmin:!1};const s=await a.json();if(s.status==="error")return c.warn("Casdoor API returned error:",s.msg),{valid:!1,isAdmin:!1};const i=this.checkIfUserIsAdmin(s);return t||localStorage.setItem("team_api_validation_result",JSON.stringify({valid:!0,isAdmin:i,timestamp:Date.now(),tokenHash:e?this.simpleTokenHash(e):null})),i&&localStorage.setItem("is_admin_validated","true"),c.info("Casdoor API validation successful, token is valid"),{valid:!0,isAdmin:i}}finally{setTimeout(()=>{this.teamApiValidationPromise=null,O(T.TEAM_API_VALIDATION)},100)}})(),this.teamApiValidationPromise}catch(n){return c.error("Casdoor API validation error:",n),this.teamApiValidationPromise=null,O(T.TEAM_API_VALIDATION),{valid:!1,isAdmin:!1}}}checkIfUserIsAdmin(e){try{return!!(e.isAdmin===!0||e.roles&&Array.isArray(e.roles)&&e.roles.some(r=>r.name==="admin"||r.name.toLowerCase().includes("admin"))||e.groups&&Array.isArray(e.groups)&&e.groups.some(r=>r.toLowerCase().includes("admin")))}catch(t){return c.error("Error checking admin status from user response:",t),!1}}simpleTokenHash(e){if(!e||e.length<16)return e;const t=e.substring(0,8),r=e.substring(e.length-8),n=e.length.toString();return`${t}_${n}_${r}`}async validateLocalToken(){if(localStorage.getItem("token_absolute_trust")==="true"||localStorage.getItem("skip_all_token_validation")==="true")return c.debug("Local validation: Absolute trust flag detected, returning true without validation"),!0;if(localStorage.getItem("token_trusted")==="true")return c.debug("Local validation: Trust flag detected, returning true without validation"),!0;const e=localStorage.getItem("auth_callback_completed_time");if(e){const r=parseInt(e);if(!isNaN(r)&&Date.now()-r<600*1e3)return c.debug("Local validation: Recent login detected (<10min), returning true without validation"),!0}const t=this.getToken();if(!t)return!1;try{const r=this.parseAccessToken(t);if(!r||!r.payload||!r.payload.exp)return!1;const n=r.payload.exp*1e3,a=Date.now();if(n>a+30*1e3)return localStorage.setItem("token_verified","true"),!0;if(n<=a+600*1e3)try{return await this.refreshAccessToken(),localStorage.setItem("token_verified","true"),!0}catch(s){return c.error("Token near expiry and refresh failed during local validation:",s),n<=a?(await this.logout(),!1):!0}return localStorage.setItem("token_verified","true"),!0}catch(r){return c.error("Error in local token validation:",r),!1}}triggerInvalidAuthEvent(e){typeof window<"u"&&window.dispatchEvent(new CustomEvent("auth:invalid",{detail:{message:e}}))}async validateToken(e=!1){const t=this.getToken();if(!t)return!1;try{if(localStorage.getItem("token_absolute_trust")==="true"||localStorage.getItem("skip_all_token_validation")==="true")return console.log("Auth: Using absolute trust flag, skipping validateToken"),!0;const r=this.parseAccessToken(t);if(!r||!r.payload||!r.payload.exp)return console.warn("Token lacks expiration information"),!1;const n=r.payload.exp*1e3,a=Date.now();if(n<=a){if(console.warn("Token has expired based on exp claim"),e)return!1;try{return await this.refreshAccessToken(),!0}catch(s){return console.error("Failed to refresh expired token:",s),await this.logout(),this.triggerInvalidAuthEvent("Your session has expired. Please login again."),!1}}return e||n-a<1800*1e3&&!e&&(console.log("Token will expire soon, preemptively refreshing"),this.refreshAccessToken().catch(s=>console.warn("Preemptive token refresh failed:",s))),!0}catch(r){return console.error("Token validation error:",r),!1}}async isTokenValid(){if(!this.isLoggedIn())return!1;if(localStorage.getItem("token_absolute_trust")==="true"||localStorage.getItem("skip_all_token_validation")==="true")return console.log("Auth: Using absolute trust flag, skipping isTokenValid check"),!0;try{if(!await this.isTokenValidWithoutRefresh()){console.warn("Basic token validation failed");try{return await this.refreshAccessToken(),!0}catch(t){return console.error("Token validation and refresh failed:",t),!1}}return!0}catch(e){return console.error("Error validating token:",e),this.validateLocalToken()}}async isTokenValidWithoutRefresh(){if(!this.isLoggedIn())return!1;if(localStorage.getItem("token_absolute_trust")==="true"||localStorage.getItem("skip_all_token_validation")==="true")return c.debug("No-refresh validation: Absolute trust flag detected, returning true without validation"),!0;if(localStorage.getItem("token_trusted")==="true")return c.debug("No-refresh validation: Trust flag detected, returning true without validation"),!0;const e=localStorage.getItem("auth_callback_completed_time");if(e){const t=parseInt(e);if(!isNaN(t)&&Date.now()-t<600*1e3)return c.debug("No-refresh validation: Recent login detected (<10min), returning true without validation"),!0}try{const t=this.getToken();if(!t)return!1;const r=this.parseAccessToken(t);if(!r||!r.payload||!r.payload.exp)return!1;const n=r.payload.exp*1e3,a=Date.now();return n<=a?(c.warn("Token has expired based on exp claim"),!1):!0}catch(t){return c.error("Error in token validation without refresh:",t),!1}}checkApiResponse(e){if(e&&e.success===!0&&e.data){const t=e.data;if(t.status==="error"&&t.msg&&(t.msg.includes("token")||t.msg.includes("Access")||t.msg.includes("exist")))return console.warn("API returned auth error:",t.msg),setTimeout(()=>{this.handleInvalidAuthResponse().catch(console.error)},0),!1}return!0}async handleInvalidAuthResponse(){try{return await this.refreshAccessToken(),!0}catch(e){return console.error("Failed to refresh token after invalid response:",e),await this.logout(),this.triggerInvalidAuthEvent("Your session has expired. Please login again."),!1}}setupTokenPeriodicCheck(){if(this.tokenCheckTimer!==null&&(window.clearInterval(this.tokenCheckTimer),this.tokenCheckTimer=null),this.isLoggedIn()){const e=ur;this.tokenCheckTimer=window.setInterval(async()=>{c.debug("Token check interval triggered, checking if validation needed");try{const t=localStorage.getItem("auth_callback_completed_time");if(t&&Date.now()-parseInt(t)<600*1e3){c.debug("Token check: Recent auth callback detected (<10min), skipping validation");return}if(localStorage.getItem("auth_validation_in_progress")==="true"){c.debug("Token check: Validation already in progress, skipping");return}const r=localStorage.getItem("last_auth_check_time");if(r&&Date.now()-parseInt(r)<6e4){c.debug("Token check: Recent validation detected, skipping check");return}localStorage.removeItem("token_absolute_trust"),localStorage.removeItem("skip_all_token_validation"),c.info("Token check: Validating token without requesting new token"),localStorage.setItem("auth_validation_in_progress","true");try{await this.isTokenValidWithoutRefresh()?(c.info("Token check: Local validation successful"),localStorage.setItem("last_token_validated_time",Date.now().toString()),localStorage.setItem("last_auth_check_time",Date.now().toString())):(c.warn("Token check: Token validation failed - token appears invalid"),this.triggerInvalidAuthEvent("Your session has expired. Please login again."),await this.logout())}finally{localStorage.removeItem("auth_validation_in_progress")}}catch(t){c.error("Error during periodic token validation:",t),localStorage.removeItem("auth_validation_in_progress")}},e)}}}function pe(o){return o.firstName&&o.lastName?`${o.firstName} ${o.lastName}`:o.displayName?o.displayName:o.name||""}function fr(o){if(!o)return!0;if(o.success===!0&&o.data&&o.data.status==="error"){const e=o.data.msg;if(e&&(e.includes("token")||e.includes("Access")||e.includes("exist")))return!0}return!!(o.status==="error"&&o.msg&&(o.msg.includes("token")||o.msg.includes("Access")||o.msg.includes("exist"))||o.status==="ok"&&(!o.sub||o.sub==="")&&(!o.name||o.name==="")&&(o.data===!0||o.data===null)&&o.data2===null)}const E=new dr;function hr(o){const e=localStorage.getItem("auth_callback_completed_time");if(!e)return!1;const t=parseInt(e,10);return isNaN(t)?!1:Date.now()-t<o*60*1e3}class ce{static knownUserMap={};static registerUserIdMapping(e,t){!e||!t||(this.knownUserMap[e]=t,c.debug(`Registered user mapping: ${e} -> ${t}`))}static registerUserMappings(e){Object.assign(this.knownUserMap,e)}static registerUserOnLogin(e){if(!e||!e.id)return;let t="";if(e.firstName&&e.lastName)t=`${e.firstName[0]}${e.lastName[0]}`.toUpperCase();else if(e.displayName){const r=e.displayName.trim().split(/\s+/);r.length>=2?t=`${r[0][0]}${r[r.length-1][0]}`.toUpperCase():t=e.displayName.substring(0,2).toUpperCase()}else e.name&&(t=e.name.substring(0,2).toUpperCase());t&&e.id&&(c.debug(`Auto-registering user mapping from login: ${t} -> ${e.id}`),this.registerUserIdMapping(t,e.id))}static getUserIdByInitial(e){return this.knownUserMap[e]}static getAllMappings(){return{...this.knownUserMap}}}typeof window<"u"&&(window.avatarMigration=ce);const gr=Object.freeze(Object.defineProperty({__proto__:null,AvatarMigrationTool:ce,default:ce},Symbol.toStringTag,{value:"Module"})),Ke=7200*1e3,Re=pt("user",{state:()=>({userInfo:null,orgData:null,isLoading:!1,error:null,lastFetchTime:null,isInitialized:!1,refreshTimer:null}),getters:{isLoggedIn(){return E.isLoggedIn()},userName(){return this.userInfo?this.userInfo.displayName||(this.userInfo.name?this.userInfo.name.split("@")[0]:"User"):"User"},isAdmin(){return this.userInfo?!!this.userInfo.isAdmin:!1},avatarUrl(){return this.userInfo?.avatar||null}},actions:{async initializeStore(o=!1){c.prettyGroup("User Store Initialization","primary",!!o);try{c.pretty("Validation Strategy",o?"Skip validation":"Requires validation",o?"warn":"info"),(localStorage.getItem("token_absolute_trust")==="true"||localStorage.getItem("skip_all_token_validation")==="true")&&(c.pretty("Trust Flag","Absolute trust flag detected, forcing skip validation","important"),o=!0);const e=localStorage.getItem("auth_callback_completed_time");if(e&&Date.now()-parseInt(e)<600*1e3){const n=Math.round((Date.now()-parseInt(e))/6e4);c.pretty("Recent Login",`Logged in ${n} minutes ago, skipping validation`,"info"),o=!0}if(this.isInitialized&&this.userInfo){if(c.pretty("Status","Already initialized with user data","success"),o)return c.pretty("Action","Skipping duplicate initialization","info"),this.userInfo;if(e&&Date.now()-parseInt(e)>=600*1e3){c.pretty("Validation","Trust period expired, using Team API to validate token","info");try{if((await E.validateWithTeamApi()).valid)c.pretty("Validation Success","Team API validation passed","success");else return c.pretty("Validation Failed","Team API validation failed, clearing user info","error"),this.clearUserInfo(),null}catch(n){if(c.pretty("Validation Error","Using local validation as fallback","warn"),c.error("Team API validation error:",n),await E.isTokenValidWithoutRefresh())c.pretty("Local Validation","Passed","success");else return c.pretty("Local Validation","Failed, clearing user info","error"),this.clearUserInfo(),null}}else if(await E.isTokenValidWithoutRefresh())c.pretty("Local Validation","Token valid","success");else return c.pretty("Local Validation","Stored token invalid, clearing user info","error"),this.clearUserInfo(),null;return this.setupAutoRefresh(),this.userInfo}if(!E.isLoggedIn())return c.pretty("Status","User not logged in, skipping initialization","warn"),null;const t=Date.now();if(this.lastFetchTime&&t-this.lastFetchTime<300*1e3){const n=Math.round((t-this.lastFetchTime)/6e4);if(c.pretty("Using Cache",`Using data from ${n} minutes ago (<5min)`,"info"),this.isInitialized=!0,o)return this.setupAutoRefresh(),this.userInfo;if(await E.isTokenValidWithoutRefresh())return c.pretty("Local Validation","Token valid","success"),this.setupAutoRefresh(),this.userInfo;c.pretty("Local Validation","Token invalid","error")}c.pretty("Action","Refreshing user info","info");const r=await this.refreshUserInfo(!1,o);return r?(c.pretty("Result","Refresh successful and auto-refresh set up","success"),this.setupAutoRefresh()):c.pretty("Result","Refresh failed","error"),r}catch(e){throw c.error("Store initialization error:",e),e}finally{c.safeGroupEnd("User Store Initialization")}},setupAutoRefresh(){this.refreshTimer&&clearInterval(this.refreshTimer),this.refreshTimer=window.setInterval(()=>{c.pretty("User Info Auto Refresh","Refreshing user info","info",!0),this.refreshUserInfo(!1).catch(o=>{c.pretty("User Info Auto Refresh","Failed","error",!0),c.error("Auto refresh user info failed:",o)})},Ke),c.pretty("Timer",`User Info Auto refresh set for every ${Ke/(3600*1e3)} hours`,"info")},async refreshUserInfo(o=!0,e=!1){c.prettyGroup("Refresh User Info","primary",!0);try{c.info(`Parameters: showLoading=${o}, skipValidation=${e}`),(localStorage.getItem("token_absolute_trust")==="true"||localStorage.getItem("skip_all_token_validation")==="true")&&(c.pretty("Trust Flag","Absolute trust flag detected, forcing skip validation","important"),e=!0);const t=localStorage.getItem("auth_callback_completed_time");if(t&&Date.now()-parseInt(t)<600*1e3){const n=Math.round((Date.now()-parseInt(t))/6e4);c.pretty("Recent Login",`Logged in ${n} minutes ago, skipping validation`,"info"),e=!0}if(e){c.pretty("Strategy","Skipping validation, getting user info directly","info");try{const n=await E.getUserInfo(o);return this.userInfo=n,this.orgData=n.data2,this.lastFetchTime=Date.now(),this.isInitialized=!0,n&&n.id&&ce.registerUserOnLogin(n),c.pretty("Result","Successfully retrieved user info","success"),n}catch(n){return c.pretty("Error","Failed to get user info","error"),c.error("Get user info detailed error:",n),this.error=n instanceof Error?n.message:String(n),null}}const r=T.USER_REFRESH;if(ke(r,1e4))return c.pretty("Re-entrancy","User info refresh already in progress, returning cached info","warn"),this.userInfo;try{const n=he(r);if(c.info(`Acquired refresh lock: ${n.success?"success":"failed"}`),o&&!this.userInfo&&(this.isLoading=!0,c.info("Setting loading state: true")),this.error=null,this.lastFetchTime&&Date.now()-this.lastFetchTime<2e3)return c.pretty("Using Cache","Using recently fetched user info (<2sec)","info"),this.userInfo;try{c.prettyGroup("API Validation Flow","secondary",!0);try{c.info("Step 1: Validating token with Casdoor API");const s=await E.validateWithTeamApi();if(s.valid)c.pretty("Validation Success","Token valid","success");else{c.pretty("Validation Failed","Attempting to refresh token","warn");try{if(c.info("Refreshing token..."),await E.refreshAccessToken(),c.info("Validating with new token"),(await E.validateWithTeamApi()).valid)c.pretty("Validation Success","Refreshed token is valid","success");else throw c.pretty("Validation Failed","Token still invalid after refresh","error"),new Error("Authentication token remains invalid after refresh")}catch(u){throw c.pretty("Refresh Failed","Unable to refresh authentication token","error"),c.error("Token refresh detailed error:",u),new Error("Authentication token is invalid")}}c.info("Step 2: Getting user info");const i=await E.getUserInfo(o);if(fr(i)){if(c.pretty("Response Error","Invalid user info response detected","error"),c.info("Attempting to handle invalid auth..."),await E.handleInvalidAuthResponse())return c.pretty("Handle Success","Retrying to get user info","info"),c.safeGroupEnd("API Validation Flow"),this.refreshUserInfo(o);throw c.pretty("Handle Failed","Authentication session expired","error"),new Error("Authentication session expired")}return c.pretty("User Info","Retrieved successfully","success"),this.userInfo=i,this.orgData=i.data2,this.lastFetchTime=Date.now(),this.isInitialized=!0,i&&i.id&&ce.registerUserOnLogin(i),s.isAdmin&&!i.isAdmin&&(c.pretty("Update Permissions","Updating admin status based on token validation result","important"),i.isAdmin=!0,this.userInfo.isAdmin=!0),c.pretty("Result","User info refresh successful","success"),i}finally{c.safeGroupEnd("API Validation Flow")}}catch(s){throw c.pretty("Error","Failed to get user info","error"),c.error("Detailed error:",s),this.error=s instanceof Error?s.message:String(s),s instanceof Error&&(s.message.includes("Authentication")||s.message.includes("Unauthorized")||s.message.includes("token"))&&(c.pretty("Auth Error","Clearing user info","error"),this.clearUserInfo()),s}}finally{this.isLoading=!1,O(r)}}catch(t){throw c.error("User info refresh error:",t),t}finally{c.safeGroupEnd("Refresh User Info")}},clearUserInfo(){c.prettyGroup("Clear User Info","warn",!0);try{this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null,c.info("Cleared user info auto-refresh timer")),this.userInfo=null,this.orgData=null,this.lastFetchTime=null,this.isInitialized=!1,c.pretty("Status","User info cleared","info")}finally{c.safeGroupEnd("Clear User Info")}},async ensureAuthenticated(){if(!E.isLoggedIn())return c.pretty("Auth Check","User not logged in","warn"),!1;if(!this.userInfo){c.pretty("Auth Check","User logged in but missing info, initializing store","info");try{return await this.initializeStore(),!!this.userInfo}catch(o){return c.pretty("Auth Check","Failed to initialize store","error"),c.error("Initialization error:",o),!1}}return c.pretty("Auth Check","User logged in and has valid info","success"),!0},updateUserInfo(o){return c.prettyGroup("Update User Info","info",!0),this.userInfo=o,o&&o.id&&ce.registerUserOnLogin(o),localStorage.setItem("userInfo",JSON.stringify(o)),c.pretty("Status","User info updated","success"),c.groupEnd(),Promise.resolve()}}}),mr=Object.freeze(Object.defineProperty({__proto__:null,useUserStore:Re},Symbol.toStringTag,{value:"Module"})),Ue=_t();Ue.use(ot);const pr=()=>({userStore:Re()}),oe=(o,e)=>{const t=o.__vccOpts||o;for(const[r,n]of e)t[r]=n;return t},_r={class:"mt-0 bg-gray-900 py-8 text-white"},vr={class:"container mx-auto px-4"},yr={class:"grid grid-cols-1 gap-8 md:grid-cols-3"},wr={class:"flex space-x-4"},Ir={href:"https://www.youtube.com/@bisonrobotics695",target:"_blank",class:"text-gray-400 hover:text-white"},kr={__name:"Footer",setup(o){return(e,t)=>{const r=M("Icon");return z(),re("footer",_r,[S("div",vr,[S("div",yr,[t[3]||(t[3]=vt('<div data-v-f4c73ad9><h3 class="mb-4 text-lg font-semibold" data-v-f4c73ad9>About Us</h3><p class="text-gray-400" data-v-f4c73ad9>Founded in 2001, Team 695 Bison Robotics is Beachwood High Schools competitive robotics team, dedicated to engaging students in a hands-on STEM environment.</p></div><div data-v-f4c73ad9><h3 class="mb-4 text-lg font-semibold" data-v-f4c73ad9>Quick Links</h3><ul class="space-y-2" data-v-f4c73ad9><li data-v-f4c73ad9><a href="https://www.beachwoodschools.org/" class="text-gray-400 hover:text-white" data-v-f4c73ad9>Beachwood Schools</a></li><li data-v-f4c73ad9><a href="https://scoutify.team695.com/" class="text-gray-400 hover:text-white" data-v-f4c73ad9>Scoutify Website</a></li></ul></div>',2)),S("div",null,[t[2]||(t[2]=S("h3",{class:"mb-4 text-lg font-semibold"},"Connect With Us",-1)),S("div",wr,[t[1]||(t[1]=S("a",{href:"https://www.instagram.com/beachwood695/",target:"_blank",class:"text-gray-400 hover:text-white"},[S("span",{class:"sr-only"},"Instagram"),S("svg",{class:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[S("path",{"fill-rule":"evenodd",d:"M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z","clip-rule":"evenodd"})])],-1)),S("a",Ir,[t[0]||(t[0]=S("span",{class:"sr-only"},"YouTube",-1)),F(r,{icon:"mdi:youtube",class:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"})])])])]),t[4]||(t[4]=S("div",{class:"mt-8 border-t border-gray-700 pt-8 text-center"},[S("span",{class:"text-gray-400"},"Made with  by "),S("mark",{class:"text-white text-md md:whitespace-nowrap inline-block md:inline font-semibold pl-2 pr-3 my-1 md:my-0 shadow-lg highlight"}," Team 695 Bison Robotics ")],-1))])])}}},nt=oe(kr,[["__scopeId","data-v-f4c73ad9"]]),Sr=le({name:"DesktopMenu",components:{RouterLink:yt},props:{menuItems:{type:Array,required:!0}}}),br={class:"hidden md:flex items-center gap-6"};function Tr(o,e,t,r,n,a){const s=M("router-link");return z(),re("div",null,[S("nav",br,[(z(!0),re(Je,null,Xe(o.menuItems,(i,u)=>(z(),me(s,{key:u,to:i.link,class:"hover:underline"},{default:Z(()=>[Te(ie(i.name),1)]),_:2},1032,["to"]))),128))])])}const at=oe(Sr,[["render",Tr]]),Ar=le({name:"DropdownMenu",components:{Menu:xt,MenuButton:Ut,MenuItems:Rt,MenuItem:Ct,Icon:Ze},props:{buttonText:{type:String,required:!0},menuItems:{type:Array,required:!0}},data(){return{isMenuOpen:!1,currentRoute:""}},methods:{closeMenu(){this.isMenuOpen=!1}},mounted(){const o=Qe();wt(o,()=>{this.closeMenu(),this.currentRoute=o.path}),this.currentRoute=o.path}});function Er(o,e,t,r,n,a){const s=M("Icon"),i=M("MenuButton"),u=M("router-link"),l=M("MenuItem"),f=M("MenuItems"),m=M("Menu");return z(),me(m,{as:"div",class:"relative md:hidden"},{default:Z(()=>[S("div",null,[F(i,{class:"inline-flex justify-center rounded-md bg-black/20 px-4 py-2 text-sm font-medium text-white hover:bg-black/30 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75"},{default:Z(()=>[Te(ie(o.buttonText)+" ",1),F(s,{class:"ml-2 h-5 w-5 text-violet-200 hover:text-violet-100",icon:"mingcute:menu-fill","aria-hidden":"true"})]),_:1})]),F(It,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:Z(()=>[F(f,{class:"absolute right-0 z-20 mt-2 w-28 origin-top-right bg-white rounded-md shadow-lg ring-1 ring-black/5 focus:outline-none overflow-hidden"},{default:Z(()=>[S("div",null,[(z(!0),re(Je,null,Xe(o.menuItems,(v,g)=>(z(),me(l,{key:g},{default:Z(()=>[F(u,{to:v.link,class:_e(["block px-4 py-2 text-sm text-gray-900 hover:bg-violet-500 hover:text-white transition-colors",{"font-bold bg-violet-500 text-white":o.currentRoute===v.link}]),onClick:o.closeMenu},{default:Z(()=>[Te(ie(v.name),1)]),_:2},1032,["to","class","onClick"])]),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})}const $r=oe(Ar,[["render",Er],["__scopeId","data-v-356b0553"]]),Cr=[{name:"Home",link:"/"},{name:"About",link:"/about"},{name:"Gallery",link:"/gallery"},{name:"Resources",link:"/resources"},{name:"Contact",link:"/contact"},{name:"Dashboard",link:"/dashboard"}],Rr=le({name:"Header",components:{DropdownMenu:$r,DesktopMenu:at},data(){return{menuItems:Cr,isDesktop:!1}}}),Ur="/assets/png/bison-robotics-CQA3LMOC.png",xr={class:"bg-primary text-primary-foreground py-4 px-4 sm:px-8 flex items-center sticky top-0 z-20"},Pr={class:"container mx-auto flex items-center justify-between"},Dr={class:"gap-1 space-x-2"};function Nr(o,e,t,r,n,a){const s=M("router-link"),i=M("DropdownMenu"),u=at;return z(),re("header",xr,[S("div",Pr,[S("div",Dr,[F(s,{to:"/",class:"hover:no-underline flex flex-row items-center"},{default:Z(()=>[...e[0]||(e[0]=[S("img",{src:Ur,alt:"695 Logo",class:"w-7 h-7 md:w-10 md:h-10 sm:w-8 sm:h-8 rounded-full"},null,-1),S("h1",{class:"ml-2 md:ml-3 leading-4 text-size-5 sm:text-xl md:text-2xl font-bold"},"695 Bison Robotics",-1)])]),_:1})]),F(i,{buttonText:"Menu",menuItems:o.menuItems},null,8,["menuItems"]),F(u,{class:"hidden md:flex items-center gap-4 transition-max-height duration-300 ease-in-out",menuItems:o.menuItems},null,8,["menuItems"])])])}const st=oe(Rr,[["render",Nr]]),Lr=le({name:"GlobalNotification",components:{Icon:Ze},setup(){const o=j(!1),e=j(""),t=j(""),r=j("info"),n=j("OK"),a=j(null),s=Ye(()=>{switch(r.value){case"error":return"mdi:alert-circle";case"success":return"mdi:check-circle";case"warning":return"mdi:alert";default:return"mdi:information"}});let i=[],u=!1;const l=()=>{if(i.length>0&&!u){u=!0;const g=i.shift();e.value=g.title,t.value=g.message,r.value=g.type,n.value=g.actionText,a.value=g.callback||null,o.value=!0}},f=()=>{o.value=!1,setTimeout(()=>{u=!1,l()},300)},m=()=>{a.value&&a.value(),f()},v=(g,w,p="info",y="OK",k)=>{const d=i.some(_=>_.title===g&&_.message===w),h=u&&e.value===g&&t.value===w;d||h||(i.push({title:g,message:w,type:p,actionText:y,callback:k}),l())};return typeof window<"u"&&(window.$notify=v),{show:o,title:e,message:t,type:r,icon:s,actionText:n,close:f,handleAction:m}}}),Or={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},Fr={class:"w-11/12 max-w-lg p-4"},Vr={class:"p-6"},Br={class:"flex items-center justify-between"},Mr={class:"flex items-center"},zr={class:"flex-shrink-0 mr-3"},qr={class:"flex-1"},Hr={class:"text-lg font-semibold text-gray-900"},Gr={class:"mt-1 text-sm text-gray-600"},Wr={class:"mt-4 flex justify-end"};function jr(o,e,t,r,n,a){const s=M("Icon");return o.show?(z(),re("div",Or,[S("div",Fr,[S("div",{class:_e(["bg-white rounded-lg shadow-xl overflow-hidden",{"border-t-4 border-blue-500":o.type==="info","border-t-4 border-red-500":o.type==="error","border-t-4 border-green-500":o.type==="success","border-t-4 border-amber-500":o.type==="warning"}])},[S("div",Vr,[S("div",Br,[S("div",Mr,[S("div",zr,[F(s,{icon:o.icon,class:_e(["w-8 h-8",{"text-blue-500":o.type==="info","text-red-500":o.type==="error","text-green-500":o.type==="success","text-amber-500":o.type==="warning"}])},null,8,["icon","class"])]),S("div",qr,[S("h3",Hr,ie(o.title),1),S("p",Gr,ie(o.message),1)])]),S("button",{onClick:e[0]||(e[0]=(...i)=>o.close&&o.close(...i)),class:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 p-1 rounded transition-colors"},[F(s,{icon:"mdi:close",class:"w-5 h-5"})])]),S("div",Wr,[S("button",{onClick:e[1]||(e[1]=(...i)=>o.handleAction&&o.handleAction(...i)),class:_e(["py-2 px-4 rounded font-medium text-white transition-colors",{"bg-blue-600 hover:bg-blue-700":o.type==="info","bg-red-500 hover:bg-red-600":o.type==="error","bg-green-500 hover:bg-green-600":o.type==="success","bg-amber-500 hover:bg-amber-600":o.type==="warning"}])},ie(o.actionText),3)])])],2)])])):Ae("",!0)}const it=oe(Lr,[["render",jr]]),D={AUTH_CALLBACK_TIME:"auth_callback_completed_time",VALIDATION_TIME:"last_token_validated_time",AUTH_CHECK_TIME:"last_auth_check_time",TOKEN_VERIFIED:"token_verified",TOKEN_TRUSTED:"token_trusted",TOKEN_ABSOLUTE_TRUST:"token_absolute_trust",SKIP_VALIDATION:"skip_all_token_validation",TRUST_EXPIRE_TIME:"trust_flags_expire_at"};function ct(o=10){const e=localStorage.getItem(D.AUTH_CALLBACK_TIME);if(!e)return!1;const t=parseInt(e);return isNaN(t)?!1:Date.now()-t<o*60*1e3}function ao(){localStorage.setItem(D.TOKEN_ABSOLUTE_TRUST,"true"),localStorage.setItem(D.TOKEN_TRUSTED,"true"),localStorage.setItem(D.TOKEN_VERIFIED,"true");const o=Date.now()+600*1e3;localStorage.setItem(D.TRUST_EXPIRE_TIME,o.toString())}function so(){const o=Date.now().toString();localStorage.setItem(D.VALIDATION_TIME,o),localStorage.setItem(D.AUTH_CHECK_TIME,o)}function Kr(){if(!ct(10)){localStorage.removeItem(D.TOKEN_ABSOLUTE_TRUST),localStorage.removeItem(D.SKIP_VALIDATION);const o=localStorage.getItem(D.TRUST_EXPIRE_TIME);if(o){const e=parseInt(o);!isNaN(e)&&Date.now()>e&&(localStorage.removeItem(D.TOKEN_TRUSTED),localStorage.removeItem(D.TRUST_EXPIRE_TIME))}}}const Jr=le({name:"ApiErrorHandler",setup(){const o=Re(),e=j(0),t=j(0),r=3,n=3e4,a=j(0),s=300*1e3,i=j(!1),u=async w=>{if(i.value)return;const p=Date.now();if(p-t.value>n&&(e.value=0),t.value=p,e.value++,e.value<=r){const y=w.detail?.message||"Your session has expired. Please login again.";i.value=!0,window.$notify?window.$notify("Authentication Error",y,"error","Login Again",()=>{l()}):(alert(y),l())}else console.warn("Too many auth errors in short period, suppressing alerts"),l()},l=async()=>{try{o.clearUserInfo(),await E.logout(),window.location.href="/login"}catch(w){console.error("Error during automatic logout:",w),window.location.href="/login"}},f=w=>{const p=w.target;if(p&&p instanceof XMLHttpRequest){(p.status===401||p.status===403)&&(console.warn("Caught XHR auth error:",p.status,p.statusText),E.handleInvalidAuthResponse().catch(console.error));try{if(p.responseText){const y=JSON.parse(p.responseText);if(y.success===!0&&y.data&&y.data.status==="error"&&y.data.msg){const k=y.data.msg;(k.includes("token")||k.includes("Access")||k.includes("exist")||k.includes("expired")||k.includes("auth"))&&(console.warn("Detected auth error in XHR response:",k),E.handleInvalidAuthResponse().catch(console.error))}}}catch{}}},m=()=>(a.value=Date.now(),setTimeout(()=>{v()},5e3),setInterval(()=>{v()},s)),v=async()=>{const w=Date.now();if(ct(10)){c.debug("ApiErrorHandler: Recent login detected (<10min), skipping validation");return}if(Kr(),w-a.value<s)return;const p=localStorage.getItem(D.AUTH_CHECK_TIME);if(p&&w-parseInt(p)<s/2){c.debug("ApiErrorHandler: AuthManager recently verified, skipping validation"),a.value=w;return}if(localStorage.getItem("auth_validation_in_progress")==="true"||localStorage.getItem("api_error_handler_validating")==="true"){c.debug("ApiErrorHandler: Validation already in progress, skipping");return}a.value=w;try{if(E.isLoggedIn()){localStorage.setItem("api_error_handler_validating","true");try{c.info("ApiErrorHandler: Performing token validation against Casdoor API"),(await E.validateWithTeamApi()).valid?(c.info("ApiErrorHandler: Casdoor API validation successful"),localStorage.setItem(D.VALIDATION_TIME,Date.now().toString()),localStorage.setItem(D.AUTH_CHECK_TIME,Date.now().toString())):(c.warn("ApiErrorHandler: Casdoor API validation failed - token is invalid"),u(new CustomEvent("auth:invalid",{detail:{message:"Your session has expired or been revoked. Please login again."}})))}finally{localStorage.removeItem("api_error_handler_validating")}}}catch(y){c.error("ApiErrorHandler: Error during validation check:",y),localStorage.removeItem("api_error_handler_validating")}};let g=null;return kt(()=>{window.addEventListener("auth:invalid",u),window.addEventListener("error",f),g=m();const w=window.fetch;window.fetch=async function(p,y){try{const k=await w(p,y),d=k.clone();return!k.ok&&(k.status===401||k.status===403)?(console.warn("Caught fetch auth error:",k.status),E.handleInvalidAuthResponse().catch(console.error),k):(d.text().then(h=>{if(h)try{const _=JSON.parse(h);if(_.success===!0&&_.data&&_.data.status==="error"&&_.data.msg){const I=_.data.msg;(I.includes("token")||I.includes("Access")||I.includes("exist")||I.includes("expired")||I.includes("auth"))&&(console.warn("Detected auth error in fetch response:",I),E.handleInvalidAuthResponse().catch(console.error))}}catch{}}).catch(h=>{}),k)}catch(k){throw k}},i.value=!1}),St(()=>{window.removeEventListener("auth:invalid",u),window.removeEventListener("error",f),g!==null&&clearInterval(g)}),{}}});function Xr(o,e,t,r,n,a){return null}const lt=oe(Jr,[["render",Xr]]),Qr=le({name:"App",components:{Header:st,Footer:nt,ApiErrorHandler:lt,GlobalNotification:it},setup(){const o=Qe();return{isDashboardRoute:Ye(()=>o.path.toLowerCase().startsWith("/dashboard"))}}});function Yr(o,e,t,r,n,a){const s=lt,i=it,u=st,l=M("router-view"),f=nt;return z(),re("div",null,[F(s),F(i),o.isDashboardRoute?Ae("",!0):(z(),me(u,{key:0})),F(l),o.isDashboardRoute?Ae("",!0):(z(),me(f,{key:1}))])}const Zr=oe(Qr,[["render",Yr]]),eo=[{path:"/:pathMatch(.*)*",name:"404NotFound",component:()=>b(()=>import("./NotFound-DWAv_IQP.js"),__vite__mapDeps([0,1]))},{path:"/",component:()=>b(()=>import("./Home-CPBByGev.js"),__vite__mapDeps([2,1,3,4,5]))},{path:"/sponsors",component:()=>b(()=>import("./Sponsors-DyxhUbge.js"),__vite__mapDeps([6,1,3]))},{path:"/about",component:()=>b(()=>import("./AboutContainerPage-NTBtnfg7.js"),__vite__mapDeps([7,1,3,4,8]))},{path:"/members",component:()=>b(()=>import("./AboutContainerPage-NTBtnfg7.js"),__vite__mapDeps([7,1,3,4,8]))},{path:"/achievements",component:()=>b(()=>import("./AboutContainerPage-NTBtnfg7.js"),__vite__mapDeps([7,1,3,4,8]))},{path:"/gallery",component:()=>b(()=>import("./Gallery-Bw5O8p3f.js"),__vite__mapDeps([9,1,4,3,10]))},{path:"/resources",component:()=>b(()=>import("./Resources-B-bEG735.js"),__vite__mapDeps([11,4,1,3,12]))},{path:"/contact",component:()=>b(()=>import("./Contact-CWLoJJO_.js"),__vite__mapDeps([13,3,1,4,14]))},{path:"/2025strategy",component:()=>b(()=>import("./2025chart-BqbJAwx3.js"),__vite__mapDeps([15,16,1,3,4,17]))},{path:"/2025strategy/html",component:()=>b(()=>import("./2025chart-html-C2cbHcpU.js"),__vite__mapDeps([18,1,3,4]))},{path:"/legal/PrivacyPolicy",component:()=>b(()=>import("./PrivacyPolicy-CRbvFjqW.js"),__vite__mapDeps([19,1,3,4,20]))},{path:"/legal/TermsOfService",component:()=>b(()=>import("./TermsOfService-BKQtUPnT.js"),__vite__mapDeps([21,1,3,4,22]))},{path:"/login",name:"login",component:()=>b(()=>import("./CasdoorLogin-c5posuRa.js"),__vite__mapDeps([23,4,1,3,24])),meta:{guest:!0}},{path:"/callback",name:"callback",component:()=>b(()=>import("./CasdoorCallback-Dp75313G.js"),__vite__mapDeps([25,4,1,3])),meta:{guest:!0}},{path:"/dashboard",redirect:()=>E.isLoggedIn()?{name:"DashboardHome"}:{name:"login"}},{path:"/Dashboard",component:()=>b(()=>import("./Index-CERnwsP3.js"),__vite__mapDeps([26,27,1,28,4,3,29])),meta:{requiresAuth:!0},children:[{path:"",name:"DashboardHome",component:()=>b(()=>import("./HomeView-k0ajIIU0.js"),__vite__mapDeps([30,4,1,31,3,32]))},{path:"Profile",name:"Profile",component:()=>b(()=>import("./ProfileView-Dc_IthO3.js"),__vite__mapDeps([33,27,1,28,4,3,34]))},{path:"API",name:"API",component:()=>b(()=>import("./APIView-CXXunyNB.js"),__vite__mapDeps([35,1,4,3,36]))},{path:"Calendar",name:"Calendar",component:()=>b(()=>import("./CalendarView-GD0nqXvG.js"),__vite__mapDeps([37,1,4,3,38]))},{path:"Pit-Scouting",name:"PitScouting",component:()=>b(()=>import("./PitScoutingView-B-pq6I-p.js"),__vite__mapDeps([39,1,4,3,40,41]))},{path:"Pit-Scouting/Admin",name:"PitScoutingAdmin",component:()=>b(()=>import("./PitScoutingAdminView-D1VXNLpl.js"),__vite__mapDeps([42,1,3,4,16,27,28,43])),meta:{requiresAdmin:!0}},{path:"Assignments",name:"Assignments",component:()=>b(()=>import("./ScoutingAssignmentView-BDtRPckq.js"),__vite__mapDeps([44,27,1,28,4,40,3,45])),meta:{requiresAdmin:!0}},{path:"System/Version",name:"SystemVersion",component:()=>b(()=>import("./VersionView-BgmDohx_.js"),__vite__mapDeps([46,4,1,31,3,47]))}]},{path:"/pit-scouting",redirect:"/Dashboard/Pit-Scouting",meta:{requiresAuth:!0}},{path:"/pit-scouting/dashboard",redirect:"/Dashboard/Pit-Scouting/Admin",meta:{requiresAuth:!0}},{path:"/User/Profile",redirect:"/Dashboard/Profile",meta:{requiresAuth:!0}},{path:"/User/API",redirect:"/Dashboard/API",meta:{requiresAuth:!0}}],ut=bt({history:Tt(),routes:eo});ut.beforeEach(async(o,e,t)=>{const r=E.isLoggedIn();if(localStorage.getItem("token_absolute_trust")==="true"){o.matched.some(n=>n.meta.requiresAuth)&&!r?t({name:"login",query:{redirect:o.fullPath}}):t();return}if(o.name==="callback"){if(!o.query.code&&r){t("/Dashboard");return}t();return}if(o.matched.some(n=>n.meta.requiresAuth)){if(!r){t({name:"login",query:{redirect:o.fullPath}});return}if(o.matched.some(n=>n.meta.requiresAdmin)&&!(await b(()=>Promise.resolve().then(()=>mr),void 0).then(s=>s.useUserStore())).userInfo?.isAdmin){t("/Dashboard");return}localStorage.setItem("validation_deferred_to_auth_manager",Date.now().toString()),t();return}if(o.matched.some(n=>n.meta.guest)&&r&&o.name!=="callback"){const n=o.query.redirect||"/Dashboard";t(n);return}t()});const to={mounted(o){function e(){const n=Array.from(o.children).find(a=>a.nodeName==="IMG");n&&(n.addEventListener("load",()=>{setTimeout(()=>{n.classList.add("loaded")},100)}),n.addEventListener("error",()=>{console.error("Error loading image")}),n.src=n.dataset.url||"")}function t(n,a){n.forEach(s=>{s.isIntersecting&&(e(),a.unobserve(o))})}function r(){const n={root:null,threshold:.1,rootMargin:"0px"};new IntersectionObserver(t,n).observe(o)}window.IntersectionObserver?r():e()}},Se=At(Zr);Se.directive("lazyLoad",to);Se.use(ut);Se.use(Ue);Ue.use(ot);pr();Se.mount("#app");setTimeout(()=>{const o=document.getElementById("loading-screen");o&&(o.classList.add("fade-out"),setTimeout(()=>{o.remove()},500))},100);export{T as A,oe as _,b as a,ct as b,E as c,so as d,Kr as e,he as f,Ge as g,ke as i,c as l,O as r,ao as s,Re as u};
