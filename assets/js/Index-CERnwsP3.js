import{_ as K}from"./CachedAvatar-BtzP3KLJ.js";import{d as W,r as _,o as Z,b as le,e as ee,E as te,y as o,k as i,l as a,G as k,A as $,q as u,D as w,H as p,F as L,z as R,B as z,N as ve,P as pe,T as fe,x as B,X as be,c as V,M as ye,C as F,Y as we,I as xe}from"./vue-vendor-BXjljxxF.js";import{I as de}from"./ui-vendor-Dw_Tg2Bf.js";import{_ as ae,u as ce,c as U,i as se,A as X,r as re,b as J,l as m,s as Se,d as Q,e as ie,f as ke}from"./index-MgNogqk5.js";import"./utils-CAMFpqwB.js";const De=[{path:"/Dashboard",text:"Dashboard",icon:"mdi:view-dashboard",section:"main",exact:!0},{path:"/Dashboard/Assignments",text:"Assignments",icon:"mdi:calendar-check",section:"scouting"},{path:"",text:"Pit Scouting",icon:"mdi:clipboard-text",section:"scouting",children:[{path:"/Dashboard/Pit-Scouting",text:"Pit Scouting Form",icon:"mdi:clipboard-text",section:"scouting",exact:!0},{path:"/Dashboard/Pit-Scouting/Admin",text:"Admin Dashboard",icon:"mdi:shield-account",section:"scouting",exact:!0,adminOnly:!0}]},{path:"/Dashboard/Profile",text:"Profile",icon:"mdi:account-circle",section:"user"},{path:"/Dashboard/API",text:"API Keys",icon:"mdi:api",section:"user"},{path:"/",text:"Main Website",icon:"mdi:home",section:"external",isExternalLink:!0},{path:"/Dashboard/System/Version",text:"Version Info",icon:"mdi:information-outline",section:"external"},{path:"https://api.team695.com/api-docs/",text:"API Docs",icon:"mdi:book-open-variant",section:"external",isExternalLink:!0,targetBlank:!0}],_e={"/Dashboard/Profile":{name:"Profile",icon:"mdi:account-circle",path:"/Dashboard/Profile"},"/Dashboard/API":{name:"API",icon:"mdi:api",path:"/Dashboard/API"},"/Dashboard/Assignments":{name:"Assignments",icon:"mdi:calendar-check",path:"/Dashboard/Assignments"},"/Dashboard/Pit-Scouting":{name:"Pit Scouting Form",icon:"mdi:clipboard-text",path:"/Dashboard/Pit-Scouting"},"/Dashboard/Pit-Scouting/Admin":{name:"Pit Scouting Admin",icon:"mdi:shield-account",path:"/Dashboard/Pit-Scouting/Admin"},"/Dashboard/Calendar":{name:"Calendar",icon:"mdi:calendar",path:"/Dashboard/Calendar"}},j={sidebarNavItems:De,breadcrumbMap:_e},Ie=W({name:"SidebarContent",components:{Icon:de,CachedAvatar:K},props:{sidebarOpen:{type:Boolean,required:!0},userData:{type:Object,required:!0},orgData:{type:Object,default:null},logout:{type:Function,required:!0}},emits:["close","toggle-sidebar"],setup(e,{emit:n}){const s=te(),y=_(localStorage.getItem("dashboard_nav_mode")||"overlay"),S=_(window.innerWidth>=720),d=c=>{c.key==="dashboard_nav_mode"&&(y.value=c.newValue||"overlay")},g=c=>{y.value=c.detail.mode},r=()=>{S.value=window.innerWidth>=720};Z(()=>{window.addEventListener("storage",d),window.addEventListener("nav-mode-changed",g),window.addEventListener("resize",r),T()}),le(()=>{window.removeEventListener("storage",d),window.removeEventListener("nav-mode-changed",g),window.removeEventListener("resize",r)});const f=_({}),b=(c,h)=>{const C=s.path.toLowerCase(),x=c.toLowerCase();let M=!1,N=!1;M=j.sidebarNavItems.some(P=>P.path.toLowerCase()===x&&P.children&&P.children.length>0);for(const P of j.sidebarNavItems)if(P.children&&P.children.find(Y=>Y.path.toLowerCase()===x)){N=!0;break}return M?!1:N?h?C===x:C.startsWith(x):h?C===x:C===x||C.startsWith(x+"/")},t=c=>{const h=s.path.toLowerCase();if(!c.path)return c.children?c.children.some(x=>{const M=x.path.toLowerCase();return h===M||h.startsWith(M+"/")}):!1;const C=c.path.toLowerCase();return h===C?!0:c.children?c.children.some(x=>{const M=x.path.toLowerCase();return h===M||h.startsWith(M+"/")}):!1},T=()=>{const c=s.path.toLowerCase();j.sidebarNavItems.forEach((h,C)=>{if(h.children&&h.children.length>0){const x=O(h,C);h.children.some(N=>{const P=N.path.toLowerCase();return c===P||c.startsWith(P+"/")})&&(f.value[x]=!0)}})},l=c=>{const h=O(c);f.value[h]=!f.value[h]},D=c=>j.sidebarNavItems.filter(h=>!(h.section!==c||h.adminOnly&&!e.userData.isAdmin)),I=()=>{n("toggle-sidebar")},O=(c,h)=>c.path?c.path:`${c.section}-${c.text}-${h||0}`,H=c=>{const h=O(c);return!!f.value[h]};return ee(s,()=>{T()}),{getNavItemsBySection:D,isActive:b,isParentActive:t,toggleSidebar:I,expandedMenus:f,toggleSubmenu:l,getSubmenuExpandedState:H,navMode:y,isLargeScreen:S}}}),Ae={class:"flex flex-col h-full"},Ce={class:"flex-shrink-0 p-2 mt-4 sm:mt-2 mb-2"},Me={class:"relative"},Pe={key:1,class:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center"},Te={key:0,class:"flex-1 min-w-0"},Le={class:"text-sm font-medium text-gray-700 truncate"},$e={class:"text-xs text-gray-500 truncate"},Oe={class:"flex-1 overflow-y-auto py-2 px-2 relative z-30 max-sm:pt-0"},Ne={key:0,class:"mb-6"},Ee={key:0,class:"px-2 mb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider"},ze={class:"space-y-1"},Ve={key:0},Ue=["onClick"],je={key:0,class:"text-sm flex-1"},Be={key:0,class:"ml-6 mt-1 space-y-1 origin-top"},We={class:"text-xs"},Fe={key:0,class:"text-sm"},Re=["href","target"],Ke={key:0,class:"text-sm"},He={class:"flex-shrink-0 p-2 border-t max-h-14 space-y-2"},Ye={key:0};function qe(e,n,s,y,S,d){const g=K,r=B("Icon"),f=B("router-link");return o(),i("div",Ae,[a("div",Ce,[a("div",{class:k(["flex items-center space-x-2 bg-gray-50 p-2 rounded-md",{"justify-center":!e.sidebarOpen}])},[a("div",Me,[e.userData.id?(o(),$(g,{key:0,userId:e.userData.id,src:e.userData.avatar,name:e.userData.name,firstName:e.userData.firstName,lastName:e.userData.lastName,displayName:e.userData.displayName,size:32,class:"h-8 w-8 rounded-full"},null,8,["userId","src","name","firstName","lastName","displayName"])):(o(),i("div",Pe,[u(r,{icon:"mdi:account",class:"h-5 w-5 text-blue-600"})]))]),e.sidebarOpen?(o(),i("div",Te,[a("p",Le,w(e.userData.displayName||e.userData.name),1),a("p",$e,w(e.userData.email),1)])):p("",!0),e.sidebarOpen?(o(),i("button",{key:1,onClick:n[0]||(n[0]=()=>e.logout()),class:"p-1.5 rounded-md text-red-500 hover:text-red-700 hover:bg-red-50 transition-colors",title:"Sign out"},[u(r,{icon:"mdi:logout",class:"w-5 h-5"})])):p("",!0)],2)]),a("nav",Oe,[(o(),i(L,null,R(["main","scouting","user","external"],b=>(o(),i(L,{key:b},[e.getNavItemsBySection(b).length>0?(o(),i("div",Ne,[e.sidebarOpen?(o(),i("h3",Ee,w(b),1)):p("",!0),a("ul",ze,[(o(!0),i(L,null,R(e.getNavItemsBySection(b),(t,T)=>(o(),i("li",{key:t.path||`${b}-${T}`},[t.children&&t.children.length>0?(o(),i("div",Ve,[a("div",{onClick:l=>e.toggleSubmenu(t),class:k(["flex items-center p-2 text-gray-600 rounded-md hover:bg-gray-100 transition-colors duration-200 cursor-pointer relative z-10",{"bg-blue-50 text-blue-600 font-medium":e.isParentActive(t),"justify-center":!e.sidebarOpen}])},[u(r,{icon:t.icon,class:k(["w-5 h-5 flex-shrink-0",{"mr-3":e.sidebarOpen}])},null,8,["icon","class"]),e.sidebarOpen?(o(),i("span",je,w(t.text),1)):p("",!0),e.sidebarOpen?(o(),$(r,{key:1,icon:e.getSubmenuExpandedState(t)?"mdi:chevron-up":"mdi:chevron-down",class:"w-4 h-4"},null,8,["icon"])):p("",!0)],10,Ue),u(fe,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"transform scale-y-0 opacity-0","enter-to-class":"transform scale-y-100 opacity-100","leave-active-class":"transition duration-200 ease-out","leave-from-class":"transform scale-y-100 opacity-100","leave-to-class":"transform scale-y-0 opacity-0"},{default:z(()=>[e.sidebarOpen&&e.getSubmenuExpandedState(t)?(o(),i("ul",Be,[(o(!0),i(L,null,R(t.children,l=>ve((o(),i("li",{key:l.path},[u(f,{to:l.path,class:k(["flex items-center p-1.5 text-gray-600 rounded-md hover:bg-gray-100 transition-colors duration-200",{"bg-blue-50 text-blue-600 font-medium":e.isActive(l.path,l.exact)}])},{default:z(()=>[u(r,{icon:l.icon,class:"w-4 h-4 mr-2"},null,8,["icon"]),a("span",We,w(l.text),1)]),_:2},1032,["to","class"])])),[[pe,!l.adminOnly||e.userData.isAdmin]])),128))])):p("",!0)]),_:2},1024)])):t.isExternalLink?(o(),i("a",{key:2,href:t.path,target:t.targetBlank?"_blank":"_self",class:k(["flex items-center p-2 text-gray-600 rounded-md hover:bg-gray-100 transition-colors duration-200 relative z-10",{"justify-center":!e.sidebarOpen}])},[u(r,{icon:t.icon,class:k(["w-5 h-5 flex-shrink-0",{"mr-3":e.sidebarOpen}])},null,8,["icon","class"]),e.sidebarOpen?(o(),i("span",Ke,w(t.text),1)):p("",!0),e.sidebarOpen&&t.targetBlank?(o(),$(r,{key:1,icon:"mdi:open-in-new",class:"h-3 w-3 ml-auto text-gray-400"})):p("",!0)],10,Re)):(o(),$(f,{key:1,to:t.path,class:k(["flex items-center p-2 text-gray-600 rounded-md hover:bg-gray-100 transition-colors duration-200 relative z-10",{"bg-blue-50 text-blue-600 font-medium":e.isActive(t.path,t.exact),"justify-center":!e.sidebarOpen}])},{default:z(()=>[u(r,{icon:t.icon,class:k(["w-5 h-5 flex-shrink-0",{"mr-3":e.sidebarOpen}])},null,8,["icon","class"]),e.sidebarOpen?(o(),i("span",Fe,w(t.text),1)):p("",!0),t.badge&&e.sidebarOpen?(o(),i("span",{key:1,class:k(["ml-auto text-xs px-1.5 py-0.5 rounded-full",`bg-${t.badge.color}-100 text-${t.badge.color}-800`])},w(t.badge.text),3)):p("",!0)]),_:2},1032,["to","class"]))]))),128))])])):p("",!0)],64))),64))]),a("div",He,[a("button",{onClick:n[1]||(n[1]=(...b)=>e.toggleSidebar&&e.toggleSidebar(...b)),class:"flex items-center justify-center w-full p-2 space-x-1 font-medium rounded-md bg-gray-100 hover:bg-gray-200 mb-1"},[a("span",null,[u(r,{icon:e.sidebarOpen?"mdi:chevron-double-left":"mdi:chevron-double-right",class:"w-5 h-5"},null,8,["icon"])]),e.sidebarOpen?(o(),i("span",Ye,"Collapse")):p("",!0)]),e.sidebarOpen?p("",!0):(o(),i("button",{key:0,onClick:n[2]||(n[2]=()=>e.logout()),class:"flex items-center justify-center w-full p-2 text-red-600 hover:bg-red-50 rounded-md"},[u(r,{icon:"mdi:logout",class:"w-5 h-5"})]))])])}const ue=ae(Ie,[["render",qe],["__scopeId","data-v-5b5c3946"]]),Ge=W({name:"DashboardLayout",components:{Icon:de,CachedAvatar:K,SidebarContent:ue},setup(){const e=ye(),n=te(),s=_(!0),y=_(!1),S=_(null),d=_("overlay"),g=_(!1),r=_(!1),f=_(null),b=_(null),t=(v,A)=>{b.value&&clearTimeout(b.value),b.value=window.setTimeout(()=>{f.value=A},500)},T=()=>{b.value&&(clearTimeout(b.value),b.value=null),setTimeout(()=>{f.value=null},1500)},l=ce(),{userInfo:D,orgData:I}=be(l),O=()=>{console.log("Initializing navigation mode...");const v=localStorage.getItem("dashboard_nav_mode"),A=localStorage.getItem("sidebar_open");window.innerWidth<720?(d.value="overlay",s.value=!1):v==="fixed"||v==="overlay"?(d.value=v,A?s.value=A==="true":s.value=d.value==="fixed"):(d.value="fixed",s.value=!0),localStorage.setItem("dashboard_nav_mode",d.value),localStorage.setItem("sidebar_open",s.value.toString())},H=V(()=>D.value||{}),c=V(()=>new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),h=V(()=>new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})),C=V(()=>{const v=n.path.toLowerCase();return v==="/dashboard"?"Dashboard":v.includes("profile")?"User Profile":v.includes("api")?"API Management":v.includes("assignments")?"Assignments":v.includes("pit-scouting/admin")?"Pit Scouting Admin":v.includes("pit-scouting")?"Pit Scouting":v.includes("calendar")?"Calendar":v.includes("system/version")?"System Version":"Dashboard"}),x={"/Dashboard/Profile":{name:"Profile",icon:"mdi:account-circle",path:"/Dashboard/Profile"},"/Dashboard/API":{name:"API",icon:"mdi:api",path:"/Dashboard/API"},"/Dashboard/Assignments":{name:"Assignments",icon:"mdi:calendar-check",path:"/Dashboard/Assignments"},"/Dashboard/Pit-Scouting":{name:"Pit Scouting Form",icon:"mdi:clipboard-text",path:"/Dashboard/Pit-Scouting"},"/Dashboard/Pit-Scouting/Admin":{name:"Pit Scouting Admin",icon:"mdi:shield-account",path:"/Dashboard/Pit-Scouting/Admin"},"/Dashboard/Calendar":{name:"Calendar",icon:"mdi:calendar",path:"/Dashboard/Calendar"},"/Dashboard/System/Version":{name:"System Version",icon:"mdi:information-outline",path:"/Dashboard/System/Version"}},M=V(()=>{const A=n.path.toLowerCase();for(const[E,G]of Object.entries(x))if(A===E.toLowerCase())return G;for(const[E,G]of Object.entries(x))if(A.startsWith(E.toLowerCase()))return G;return null}),N=async()=>{try{await U.logout(),l.clearUserInfo(),await e.push({name:"login"}),setTimeout(()=>{window.location.reload()},100)}catch(v){console.error("Logout failed:",v),e.push({name:"login"}),setTimeout(()=>{window.location.reload()},100)}},P=V(()=>[{text:"Your Profile",icon:"mdi:account-circle",path:"/Dashboard/Profile"},{text:"API Keys",icon:"mdi:api",path:"/Dashboard/API"},{divider:!0},{text:"Sign out",icon:"mdi:logout",iconClass:"text-red-500",action:N}]),oe=v=>x[v]?.icon||"mdi:chevron-right",Y=()=>{s.value=!s.value,localStorage.setItem("sidebar_open",s.value.toString())},he=()=>{(d.value==="overlay"||!g.value)&&(s.value=!1,localStorage.setItem("sidebar_open","false"))},me=()=>{if(window.innerWidth<720){r.value=!0,setTimeout(()=>{r.value=!1},2e3),console.log("Mobile devices cannot switch to fixed mode");return}d.value=d.value==="fixed"?"overlay":"fixed",d.value==="fixed"?s.value=!0:s.value=!1,localStorage.setItem("dashboard_nav_mode",d.value),localStorage.setItem("sidebar_open",s.value.toString()),console.log("Saved settings:",{navMode:d.value,sidebarOpen:s.value})},ge=()=>{y.value=!y.value},ne=v=>{y.value&&S.value&&!S.value.contains(v.target)&&(y.value=!1)},q=()=>{const v=g.value;if(g.value=window.innerWidth>=720,v!==g.value){if(!g.value)d.value="overlay",s.value=!1,localStorage.setItem("dashboard_nav_mode",d.value),localStorage.setItem("sidebar_open","false");else{const A=localStorage.getItem("dashboard_nav_mode"),E=localStorage.getItem("sidebar_open");A&&(A==="fixed"||A==="overlay")?d.value=A:(d.value="fixed",localStorage.setItem("dashboard_nav_mode","fixed")),d.value==="fixed"?(s.value=E!=="false",localStorage.setItem("sidebar_open",s.value.toString())):(s.value=E==="true",localStorage.setItem("sidebar_open",s.value.toString()))}window.dispatchEvent(new CustomEvent("nav-mode-changed",{detail:{mode:d.value,sidebarOpen:s.value}}))}};return ee(()=>n.path,()=>{y.value=!1,(!g.value||d.value==="overlay")&&(s.value=!1,localStorage.setItem("sidebar_open","false"))}),Z(()=>{console.log("Component mounted"),O(),document.addEventListener("click",ne),window.addEventListener("resize",q),q(),U.isLoggedIn()&&l.initializeStore()}),le(()=>{document.removeEventListener("click",ne),window.removeEventListener("resize",q)}),{sidebarOpen:s,showUserMenu:y,showMobileWarning:r,userMenuContainer:S,userData:H,orgData:I,currentDate:c,currentDateShort:h,pageTitle:C,currentBreadcrumb:M,navMode:d,isLargeScreen:g,toggleSidebar:Y,closeSidebar:he,toggleNavMode:me,toggleUserMenu:ge,logout:N,getBreadcrumbIcon:oe,userMenuItems:P,navigationConfig:j,handleTouchStart:t,handleTouchEnd:T,activeTouchTooltip:f}}}),Xe={class:"min-h-screen bg-gray-50 flex"},Je={class:"flex flex-col flex-1 h-full overflow-hidden transition-all duration-300 ease-in-out"},Qe={class:"flex-shrink-0 border-b bg-white shadow-sm fixed top-0 left-0 right-0 z-[50] transition-all duration-300 ease-in-out w-full"},Ze={class:"flex items-center justify-between p-2 px-4"},et={class:"flex items-center space-x-3"},tt={class:"block"},at={class:"md:text-xl sm:text-lg font-semibold text-gray-800 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent"},ot={class:"text-[12px] lg:text-sm leading-none text-gray-600"},nt={class:"relative flex items-center space-x-3"},st={class:"items-center hidden md:flex"},rt={class:"relative group"},it={class:"relative group ml-1"},lt={class:"absolute left-1/2 -translate-x-1/2 top-full mt-1 w-max opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50"},dt={class:"bg-gray-800 text-white text-xs px-2 py-1 rounded shadow-lg whitespace-nowrap"},ct={class:"relative",ref:"userMenuContainer"},ut={class:"flex items-center space-x-2"},ht={class:"relative flex-shrink-0 flex items-center justify-center w-8 h-8"},mt={key:1,class:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center"},gt={class:"hidden md:block text-left"},vt={class:"text-sm font-medium text-gray-700 text-left"},pt={class:"text-xs text-gray-500 text-left"},ft={key:0,class:"absolute right-0 z-10 w-48 mt-2 overflow-hidden origin-top-right bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},bt={class:"py-1"},yt={class:"flex items-center"},wt=["onClick"],xt={class:"flex items-center"},St={key:2,class:"border-t border-gray-200"},kt={class:"flex-1 overflow-auto pt-[60px]"},Dt={class:"flex items-center mt-4 mb-2 mx-4 space-x-2 text-sm p-3 bg-white rounded-lg shadow-sm border border-gray-100 transition-all hover:shadow-md"},_t={class:"flex items-center justify-center bg-blue-50 p-1.5 rounded-md"},It={class:"flex items-center text-gray-400"},At={class:"flex items-center text-blue-600 font-medium"},Ct={class:"flex items-center justify-center bg-blue-50 p-1.5 rounded-md"},Mt={class:"ml-1.5"},Pt={class:"text-sm text-gray-500"},Tt={class:"flex items-center space-x-4"},Lt={href:"https://www.instagram.com/beachwood695/",target:"_blank",class:"text-gray-500 hover:text-gray-600"},$t={href:"https://github.com/FRCTeam695",target:"_blank",class:"text-gray-500 hover:text-gray-600"},Ot={key:3,class:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black/80 text-white py-2 px-3 rounded-md z-[100] text-sm max-w-[280px] text-center"};function Nt(e,n,s,y,S,d){const g=ue,r=B("Icon"),f=B("router-link"),b=K;return o(),i("div",Xe,[e.navMode==="overlay"?(o(),i("aside",{key:0,class:k(["fixed inset-y-0 z-[30] flex flex-col flex-shrink-0 w-64 max-h-screen overflow-hidden transition-all transform bg-white border-r shadow-lg pt-[60px] mobile-sidebar",{"-translate-x-full":!e.sidebarOpen,"translate-x-0":e.sidebarOpen}])},[u(g,{sidebarOpen:e.sidebarOpen,userData:e.userData,orgData:e.orgData,onClose:e.closeSidebar,onToggleSidebar:e.toggleSidebar,logout:e.logout},null,8,["sidebarOpen","userData","orgData","onClose","onToggleSidebar","logout"])],2)):p("",!0),e.navMode==="fixed"?(o(),i("aside",{key:1,class:k(["flex-shrink-0 flex flex-col transition-all duration-300 ease-in-out bg-white border-r shadow-sm h-screen sticky top-0 pt-[60px]",{"w-64":e.sidebarOpen,"w-20":!e.sidebarOpen}])},[u(g,{sidebarOpen:e.sidebarOpen,userData:e.userData,orgData:e.orgData,onClose:e.closeSidebar,onToggleSidebar:e.toggleSidebar,logout:e.logout},null,8,["sidebarOpen","userData","orgData","onClose","onToggleSidebar","logout"])],2)):p("",!0),e.sidebarOpen&&e.navMode==="overlay"?(o(),i("div",{key:2,class:"fixed inset-0 z-[20] bg-black bg-opacity-30",onClick:n[0]||(n[0]=(...t)=>e.closeSidebar&&e.closeSidebar(...t))})):p("",!0),a("div",Je,[a("header",Qe,[a("div",Ze,[a("div",et,[a("button",{onClick:n[1]||(n[1]=(...t)=>e.toggleSidebar&&e.toggleSidebar(...t)),class:"p-2 rounded-md hover:bg-gray-100 relative"},[!e.sidebarOpen||e.navMode==="overlay"?(o(),$(r,{key:0,icon:"mdi:menu",class:"w-6 h-6 text-gray-600"})):(o(),$(r,{key:1,icon:"mdi:chevron-double-left",class:"w-6 h-6 text-gray-600"}))]),a("div",tt,[a("h1",at,w(e.pageTitle),1),a("p",ot,w(e.currentDate),1)])]),a("div",nt,[a("div",st,[a("div",rt,[u(f,{to:"/",class:"hover:bg-gray-100 p-2 rounded-md text-gray-500 hover:text-gray-700 flex items-center justify-center",onTouchstart:n[2]||(n[2]=t=>e.handleTouchStart(t,"home")),onTouchend:e.handleTouchEnd},{default:z(()=>[u(r,{icon:"mdi:home",class:"w-5 h-5"})]),_:1},8,["onTouchend"]),n[7]||(n[7]=a("div",{class:"absolute left-1/2 -translate-x-1/2 top-full mt-1 w-max opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50"},[a("div",{class:"bg-gray-800 text-white text-xs px-2 py-1 rounded shadow-lg whitespace-nowrap"}," Go to Home ")],-1))]),a("div",it,[a("button",{onClick:n[3]||(n[3]=(...t)=>e.toggleNavMode&&e.toggleNavMode(...t)),class:"hover:bg-gray-100 p-2 rounded-md text-gray-500 hover:text-gray-700 flex items-center justify-center",onTouchstart:n[4]||(n[4]=t=>e.handleTouchStart(t,"navMode")),onTouchend:n[5]||(n[5]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t))},[u(r,{icon:e.navMode==="fixed"?"mdi:dock-left":"mdi:dock-window",class:"w-5 h-5"},null,8,["icon"])],32),a("div",lt,[a("div",dt,w(e.navMode==="fixed"?"Switch to Overlay Mode":"Switch to Fixed Mode"),1)])])]),a("div",ct,[a("button",{onClick:n[6]||(n[6]=(...t)=>e.toggleUserMenu&&e.toggleUserMenu(...t)),class:"flex items-center p-2 rounded-md hover:bg-gray-100"},[n[8]||(n[8]=a("span",{class:"sr-only"},"User menu",-1)),a("div",ut,[a("div",ht,[e.userData.id?(o(),$(b,{key:0,userId:e.userData.id,src:e.userData.avatar,name:e.userData.name,firstName:e.userData.firstName,lastName:e.userData.lastName,displayName:e.userData.displayName,size:32,class:"h-8 w-8 rounded-full object-cover"},null,8,["userId","src","name","firstName","lastName","displayName"])):(o(),i("div",mt,[u(r,{icon:"mdi:account",class:"h-5 w-5 text-blue-600"})]))]),a("div",gt,[a("h2",vt,w(e.userData.displayName||e.userData.name),1),a("p",pt,w(e.userData.isAdmin?"Administrator":"Team Member"),1)]),u(r,{icon:"mdi:chevron-down",class:"w-4 h-4 text-gray-500"})])]),e.showUserMenu?(o(),i("div",ft,[a("div",bt,[(o(!0),i(L,null,R(e.userMenuItems,t=>(o(),i(L,{key:t.text},[t.path?(o(),$(f,{key:0,to:t.path,class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},{default:z(()=>[a("div",yt,[u(r,{icon:t.icon||"mdi:circle-small",class:k(["w-4 h-4 mr-2",t.iconClass])},null,8,["icon","class"]),F(" "+w(t.text),1)])]),_:2},1032,["to"])):t.action?(o(),i("button",{key:1,onClick:t.action,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[a("div",xt,[u(r,{icon:t.icon||"mdi:circle-small",class:k(["w-4 h-4 mr-2",t.iconClass])},null,8,["icon","class"]),F(" "+w(t.text),1)])],8,wt)):t.divider?(o(),i("div",St)):p("",!0)],64))),128))])])):p("",!0)],512)])])]),a("div",kt,[a("main",{class:k(["p-2 mb-4 mx-auto w-full max-w-7xl",{"filter blur-sm pointer-events-none":e.sidebarOpen&&e.navMode==="overlay"&&!e.isLargeScreen}])},[a("div",Dt,[u(f,{to:"/Dashboard",class:"flex items-center text-gray-600 hover:text-blue-600 transition-colors duration-200"},{default:z(()=>[a("span",_t,[u(r,{icon:"mdi:view-dashboard",class:"w-4 h-4 text-blue-500"})]),n[9]||(n[9]=a("span",{class:"ml-1.5 font-medium"},"Dashboard",-1))]),_:1}),e.currentBreadcrumb?(o(),i(L,{key:0},[a("span",It,[u(r,{icon:"mdi:chevron-right",class:"w-4 h-4"})]),a("span",At,[a("span",Ct,[u(r,{icon:e.getBreadcrumbIcon(e.currentBreadcrumb.path),class:"w-4 h-4 text-blue-500"},null,8,["icon"])]),a("span",Mt,w(e.currentBreadcrumb.name),1)])],64)):p("",!0)]),we(e.$slots,"default",{},void 0)],2),a("footer",{class:k(["flex items-center justify-between p-4 border-t",{"filter blur-sm pointer-events-none":e.sidebarOpen&&e.navMode==="overlay"&&!e.isLargeScreen}])},[a("div",null,[a("p",Pt," Â© "+w(new Date().getFullYear())+" Team 695. All rights reserved. ",1)]),a("div",Tt,[a("a",Lt,[u(r,{icon:"mdi:instagram",class:"w-5 h-5"})]),a("a",$t,[u(r,{icon:"mdi:github",class:"w-5 h-5"})])])],2)])]),e.activeTouchTooltip?(o(),i("div",Ot,[e.activeTouchTooltip==="home"?(o(),i(L,{key:0},[F(" Go to Home ")],64)):e.activeTouchTooltip==="navMode"?(o(),i(L,{key:1},[F(w(e.navMode==="fixed"?"Switch to Overlay Mode":"Switch to Fixed Mode"),1)],64)):p("",!0)])):p("",!0)])}const Et=ae(Ge,[["render",Nt],["__scopeId","data-v-1606bc94"]]),zt=W({name:"AuthManager",setup(){const e=te(),n=ce(),s=_(Date.now()),y=300*1e3;let S=null,d=_(!0);const g=_(null),r=async()=>{if(J(10)){if(m.debug("AuthManager: In trust period (<10min), using lightweight validation"),localStorage.setItem("is_periodic_validation","false"),!n.userInfo)try{await n.initializeStore(!0)}catch(I){m.warn("Failed to initialize user store during trust period:",I)}try{await U.validateWithTeamApi(),s.value=Date.now(),Q()}catch(I){m.warn("API validation during trust period failed, but continuing:",I)}return}ie();const D=X.VALIDATION;if(se(D)){m.debug("AuthManager: Another validation is in progress, skipping");return}return g.value||(g.value=(async()=>{try{if(ke(D),localStorage.setItem("auth_validation_start_time",Date.now().toString()),m.info("AuthManager: Validating authentication..."),localStorage.setItem("is_periodic_validation","true"),!e.path.startsWith("/Dashboard"))return;if(!U.isLoggedIn()){m.warn("AuthManager: User not logged in, redirecting to login"),await f("You need to login to access this page");return}if(!(await U.validateWithTeamApi()).valid){m.warn("AuthManager: Casdoor API validation failed"),m.error("AuthManager: Token is invalid or revoked, logging out"),await f("Your session has expired or been revoked. Please login again.");return}if(s.value=Date.now(),Q(),!n.userInfo)try{await n.initializeStore(!0)}catch(O){m.error("AuthManager: Failed to load user info after validation:",O)}}catch(I){m.error("AuthManager: Authentication validation error:",I)}finally{localStorage.removeItem("is_periodic_validation"),g.value=null,re(D)}})()),g.value},f=async l=>{try{n.clearUserInfo(),await U.logout(),l?window.$notify?window.$notify("Authentication Error",l,"error","Login Again",()=>{window.location.href=`/login?redirect=${encodeURIComponent(e.fullPath)}`}):(alert(l),window.location.href=`/login?redirect=${encodeURIComponent(e.fullPath)}`):window.location.href=`/login?redirect=${encodeURIComponent(e.fullPath)}`}catch(D){m.error("AuthManager: Error during auth failure handling:",D),window.location.href=`/login?redirect=${encodeURIComponent(e.fullPath)}`}},b=()=>{S!==null&&window.clearInterval(S),s.value=Date.now(),S=window.setInterval(()=>{if(d.value&&!g.value){if(J(10)){m.debug("AuthManager: Periodic check skipped due to recent login (<10min)");return}m.info("AuthManager: Periodic auth check triggered"),r().catch(l=>m.error("Periodic validation error:",l))}else m.debug("AuthManager: Periodic check skipped - page invisible or validation in progress")},y)},t=()=>{d.value=document.visibilityState==="visible",d.value&&Date.now()-s.value>=y&&(m.info("Page became visible, performing authentication check"),r().catch(l=>m.error("Visibility change validation error:",l)))},T=async l=>{const D=l;m.warn("AuthManager: Auth invalid event detected:",D.detail),await f(D.detail?.message)};return ee(()=>e.path,(l,D)=>{l!==D&&l.startsWith("/Dashboard")&&r().catch(I=>m.error("Route change validation error:",I))}),Z(()=>{se(X.VALIDATION,3e4)||re(X.VALIDATION),J(10)?(m.debug("AuthManager: Recent login detected on mount (<10min), skipping validation"),Se(),s.value=Date.now(),Q(),n.userInfo||n.initializeStore(!0).catch(l=>{m.warn("Failed to load user info during trust period:",l)})):(ie(),m.info("AuthManager: Not in trust period, performing validation"),r().catch(l=>m.error("Initial validation error:",l))),b(),window.addEventListener("auth:invalid",T),document.addEventListener("visibilitychange",t)}),xe(()=>{S!==null&&window.clearInterval(S),window.removeEventListener("auth:invalid",T),document.removeEventListener("visibilitychange",t)}),{}}}),Vt={"aria-hidden":"true",class:"auth-manager-component"};function Ut(e,n,s,y,S,d){return o(),i("div",Vt)}const jt=ae(zt,[["render",Ut],["__scopeId","data-v-48c4014f"]]),Bt=W({name:"DashboardIndexView"}),Yt=W({...Bt,setup(e){return(n,s)=>{const y=B("router-view");return o(),$(Et,null,{default:z(()=>[u(jt),u(y)]),_:1})}}});export{Yt as default};
