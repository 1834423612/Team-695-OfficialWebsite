import{f as z,r as y,y as o,q as A,o as L,N as u,a8 as C,_ as E,c as f,j as h,a9 as B,a7 as S,n as M,a as U,t as j,d as c}from"./index-ChunK-zk.js";function q(e,n){let i=0,r=null;return function(...s){const m=Date.now(),l=m-i;l>=n?(i=m,e(...s)):r||(r=window.setTimeout(()=>{e(...s)},n-l))}}const D=z({name:"CachedAvatar",inheritAttrs:!1,props:{userId:{type:String,required:!1,default:""},initial:{type:String,default:""},src:{type:String,default:null},size:{type:[Number,String],default:32},alt:{type:String,default:"User Avatar"},name:{type:String,default:""},firstName:{type:String,default:""},lastName:{type:String,default:""},displayName:{type:String,default:""},rounded:{type:Boolean,default:!0},border:{type:Boolean,default:!1},bgColor:{type:String,default:""}},setup(e,{expose:n}){const i=y(null),r=y(!0),s=y(!1),m=o(()=>({width:typeof e.size=="number"?`${e.size}px`:e.size,height:typeof e.size=="number"?`${e.size}px`:e.size})),l=o(()=>e.userId&&e.userId.length>2?e.userId:e.userId||e.initial||"default"),I=o(()=>{const a={width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:typeof e.size=="number"?`${Math.max(e.size/2.5,12)}px`:"16px",fontWeight:"bold",textTransform:"uppercase"};if(e.bgColor)a.backgroundColor=e.bgColor;else{let t=e.displayName||e.name||e.firstName||e.initial||"";t||(t=e.userId||"default");const v=b(t)%360;a.backgroundColor=`hsl(${v}, 70%, 75%)`,a.color=v>210&&v<330?"#fff":"#333"}return a}),g=o(()=>{if(e.firstName&&e.lastName)return`${e.firstName[0]}${e.lastName[0]}`.toUpperCase();if(e.displayName){const a=e.displayName.trim().split(/\s+/);return a.length>=2?`${a[0][0]}${a[a.length-1][0]}`.toUpperCase():e.displayName.substring(0,2).toUpperCase()}if(e.name){const a=e.name.trim().split(/\s+/);return a.length>=2?`${a[0][0]}${a[a.length-1][0]}`.toUpperCase():e.name.substring(0,2).toUpperCase()}return(e.userId||"XX").substring(0,2).toUpperCase()}),N=a=>{if(a){if(a.firstName&&a.lastName)return`${a.firstName[0]}${a.lastName[0]}`.toUpperCase();if(a.displayName){const t=a.displayName.trim().split(/\s+/);return t.length>=2?`${t[0][0]}${t[t.length-1][0]}`.toUpperCase():a.displayName.substring(0,2).toUpperCase()}if(a.name){const t=a.name.trim().split(/\s+/);return t.length>=2?`${t[0][0]}${t[t.length-1][0]}`.toUpperCase():a.name.substring(0,2).toUpperCase()}if(a.userId)return a.userId.substring(0,2).toUpperCase()}return g.value},$=q(async()=>{r.value=!0,s.value=!1;try{const a=e.src,t=l.value;u.debug(`Loading avatar for ${e.userId?"userId: "+e.userId:"initial: "+e.initial}${a?` with URL: ${a}`:" (no URL)"}`);const d=await C.getAvatar(t,a||void 0,{firstName:e.firstName,lastName:e.lastName,displayName:e.displayName,name:e.name,initial:e.initial},!a);i.value=d,r.value=!1,a?u.debug(`${d===a?"Using original":"Using cached"} avatar for ${t}`):u.debug(`Generated default avatar for ${t}`)}catch(a){u.error(`Error loading avatar for ${l.value}:`,a),s.value=!0,i.value=null}finally{r.value=!1}},300),w=()=>{u.warn(`Avatar image load failed for: ${e.displayName||e.name||e.initial||e.userId||"unknown"}`),s.value=!0,i.value=null,l.value&&C.getAvatar(l.value,void 0,{firstName:e.firstName,lastName:e.lastName,displayName:e.displayName,name:e.name,initial:e.initial},!0).then(a=>{i.value=a}).catch(()=>{})},k=()=>{u.debug(`Avatar loaded successfully for: ${e.displayName||e.name||e.initial||e.userId||"unknown"}`),r.value=!1},b=a=>{if(!a)return 0;let t=0;for(let d=0;d<a.length;d++)t=(t<<5)-t+a.charCodeAt(d),t=t&t;return Math.abs(t)};return A([()=>l.value,()=>e.src,()=>e.firstName,()=>e.lastName,()=>e.displayName,()=>e.name,()=>e.initial],()=>{l.value&&$()},{immediate:!1}),L(()=>{if(l.value&&$(),e.src){const a=new Image;a.src=e.src,a.onload=()=>{u.debug(`Preloaded image: ${e.src}`)}}}),n({getUserInitials:N,initials:g}),{avatarSrc:i,loading:r,effectiveId:l,containerStyle:m,fallbackStyle:I,initials:g,handleImageError:w,handleImageLoaded:k,hashCode:b,getUserInitials:N}}}),P=["src","alt"],R={key:2,class:"avatar-loading"};function T(e,n,i,r,s,m){return c(),f("div",{class:"avatar-container",style:S(e.containerStyle)},[e.avatarSrc?(c(),f("img",B({key:0,src:e.avatarSrc,alt:e.alt,class:["avatar-image",{"rounded-full":e.rounded,border:e.border}],onError:n[0]||(n[0]=(...l)=>e.handleImageError&&e.handleImageError(...l))},e.$attrs,{onLoad:n[1]||(n[1]=(...l)=>e.handleImageLoaded&&e.handleImageLoaded(...l))}),null,16,P)):h("",!0),!e.avatarSrc&&!e.loading?(c(),f("div",{key:1,class:M(["avatar-fallback",{"rounded-full":e.rounded}]),style:S(e.fallbackStyle)},[U("span",null,j(e.initials),1)],6)):h("",!0),e.loading?(c(),f("div",R,n[2]||(n[2]=[U("div",{class:"spinner"},null,-1)]))):h("",!0)],4)}const F=E(D,[["render",T],["__scopeId","data-v-71d40e50"]]);export{F as _};
